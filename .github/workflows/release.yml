name: Release

on:
  push:
    tags:
      - 'v*.*.*'

jobs:
  build:
    name: Build ArchivesSpace Release
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        include:
          # - os: ubuntu-latest
          #   file_ext: zip
          - os: windows-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Setup Java
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '11'

      - name: Get the version
        id: version
        run: echo ::set-output name=VERSION::$(echo $GITHUB_REF)

      - name: Get the release name
        id: release_name
        run: echo ::set-output name=RELEASE_NAME::$(echo $GITHUB_REF)

      - name: Install compiler
        id: install_cc
        uses: rlalik/setup-cpp-compiler@v1.1
        with:
          compiler: latest

      - name: Build Dist
        # run: ./build/run build-dist -Dversion=${{ github.ref }}
        run: ./build/run build-dist -Dversion=v9.9.9
        env:
          CC: ${{ steps.install_cc.outputs.cc }}
          CXX: ${{ steps.install_cc.outputs.cxx }}

      - name: Upload Binaries to Release
        uses: svenstaro/upload-release-action@v2
        with:
          # release_name: ${{ steps.release_name.outputs.RELEASE_NAME }}
          body: Insert release notes here
          file: archivesspace-v9.9.9.zip
          asset_name: archivesspace-windows-test.zip
