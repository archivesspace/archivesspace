<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Backup and recovery - ArchivesSpace</title>
    <link rel="stylesheet" href="/assets/stylesheets/main.css">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" defer></script>
    <script src="/assets/javascripts/site.js" type="text/javascript" charset="utf-8" defer></script>
    <script src="/assets/javascripts/main.js" type="text/javascript" charset="utf-8" defer></script>
    <link rel="alternate" type="application/atom+xml" href="/blog.xml">
  </head>
  <body>
    <div class="wrapper">

      <header class="top">
  <div class="row topbar">
    <h1 id="logo" class="logo">
  <a href="http://archivesspace.org/" title="ArchivesSpace">ArchivesSpace</a>
</h1>

    <nav>
      <ul id="navigation" class="navigation">
        <li><a href="https://archivesspace.atlassian.net/wiki/display/ADC/ArchivesSpace">Wiki</a></li>
        <li><a href="http://docs.archivesspace.org">User Docs</a></li>
        <li class="toggle"><button type="button" id="toggle-menu" class="button--teal">Menu</button></li>
      </ul>
    </nav>
  </div>
</header>


      <div id="content" class="row">

        <div id="sidebar" class="sidebar">
  <div>
    <!-- <h2>Search</h2> -->
    <div class="searchbox">
      <form>
        <input type="text" id="st-search-input" class="searchbox-input" placeholder="Search the docs" />
      </form>
      <script type="text/javascript">
          (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
            (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
            e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
            })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

              _st('install','R97A3uv-TMx4aozWwT1Y','2.0.0');
            </script>
    
    </div>
  </div>
  <!-- <section>
    <h2>Newsletter</h2>
    <div id="mc_embed_signup" style="margin-left: 1.5em; margin-top: 0.5em;">
      <form
         action="http://travis-ci.us7.list-manage.com/subscribe/post?u=8ce724a4c9af4dace663cd39c&amp;id=44f8dff14c"
         method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate"
         target="_blank" novalidate>
        <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required/>
        <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button">
      </form>
    </div>
  </section>
  <section>
    <h2><a href="http://travis-ci.com/?utm_source=docs.travis-ci.org&utm_medium=referral&utm_content=textlink&utm_campaign=docsite_sidebar">Travis CI for Private Repositories</a></h2>
  </section> -->

  <section>
    <h2>Menu</h2>
    <nav>
      <ul>
        <li><a href="/user/system-requirements/">System Requirements</a></li>
        <li><a href="/user/getting-started/">Getting started</a></li>
        <li><a href="/user/configuring-archivesspace/">Configuring ArchivesSpace</a></li>
        <li><a href="/user/upgrading-to-a-new-release-of-archivesspace/">Upgrading ArchivesSpace</a></li>
        <li><a href="/user/running-archivesspace-as-a-unix-daemon/">Running ArchivesSpace as a Unix daemon</a></li>
        <li><a href="/user/running-archivesspace-as-a-windows-service/">Running ArchivesSpace as a Windows Service</a></li>
        <li><a href="/user/running-archivesspace-under-tomcat/">Running ArchivesSpace under Tomcat</a></li>
        <li><a href="/user/running-archivesspace-against-mysql/">Setting up MySQL for Production</a></li>
        <li><a href="/user/backup-and-recovery/">Backup and Recovery</a></li>
        <li><a href="/user/re-creating-indexes/">Re-creating your indexes</a></li>
        <li><a href="/user/resetting-passwords/">Resetting Passwords</a></li>
        <li><a href="/user/configuring-ldap-authentication/">Configuring LDAP authentication</a></li>
        <li><a href="/user/archivesspace-plug-ins-readme/">Plugins and Local Customizations</a></li>
        <li><a href="/user/running-archivesspace-under-a-prefix/">Deploying under a URL prefix</a></li>
        <li><a href="/user/running-archivesspace-with-external-solr/">Using an external Solr index</a></li>
        <li><a href="/user/application-monitoring-with-new-relic/">Monitoring with New Relic</a></li>
      </ul>
      <h2>Developer Guides</h2>
      <ul>
        <li><a href="/user/archivesspace-architecture-overview">Architecture Overview</a></li>
        <li><a href="/api">The API</a></li>
        <li><a href="/user/archivesspace-build-system">Building ArchivesSpace</a></li>
        <li><a href="/user/selenium-test-suite">Running Selenium Tests</a></li>
        <li><a href="/doc">Ruby YARD Documentation</a></li>
        <li><div class="status-circle status">Status:</div>
          <a href="https://travis-ci.org/archivesspace/archivesspace">Travis CI Status</a>
        </li>
      </ul>
    </nav>
  </section>
  <section>
    <h2>Contact</h2>
    <ul>
      <li><a href="https://twitter.com/archivesspace">Twitter</a></li>
      <li><a href="irc://chat.freenode.net/%23archivesspace">IRC</a></li>
      <li><a href="http://github.com/archivesspace">GitHub</a></li>
    </ul>
  </section>
  <section>
    <h2>Contributing</h2>
    <p>This documentation site is open source.
      The <a href="https://github.com/archivesspace/archivesspace/tree/gh-pages">README in our Git repository</a> explains how to contribute.</p>
      <p>This documentation was based on the <a href="https://travis-ci.org">Travis CI</a> documentation. It uses <a href="https://github.com/jekyll/jekyll">Jekyll</a> and <a href="https://github.com/tripit/slate">Slate</a></p>
  </section>
</div><!-- /#sidebar -->


        <main id="main" class="main">
          
            <h1 class="title">Backup and recovery</h2>
          
          <h2 id="creating-backups-using-the-provided-script">Creating backups using the provided script</h2>

<p>ArchivesSpace provides some simple scripts for backing up a single
instance to a <code>.zip</code> file.  You can run:</p>

<pre><code> scripts/backup.sh --output /path/to/backup-yyyymmdd.zip
</code></pre>

<p>and the script will generate a file containing:</p>

<ul>
  <li>
    <p>A snapshot of the demo database (if you’re using the demo
database)</p>
  </li>
  <li>
    <p>A snapshot of the Solr index and related indexer files</p>
  </li>
</ul>

<p>If you are running against MySQL and have <code>mysqldump</code> installed, you
can also provide the <code>--mysqldump</code> option.  This will read the
database settings from your configuration file and add a dump of your
MySQL database to the resulting <code>.zip</code> file.</p>

<h2 id="managing-your-own-backups">Managing your own backups</h2>

<p>If you want more control over your backups, you can develop your own
scripts.  ArchivesSpace stores all persistent data in the database, so
as long as you have backups of your database then you can always
recover.</p>

<p>If you are running MySQL, the <code>mysqldump</code> utility can dump the database
schema and data to a file.  It’s a good idea to run this with the
<code>--single-transaction</code> option to avoid locking your database tables
while your backups run.</p>

<p>If you are running with the demo database, you can create periodic
database snapshots using the following configuration settings:</p>

<pre><code> # In this example, we create a snapshot at 4am each day and keep
 # 7 days' worth of backups
 #
 # Database snapshots are written to 'data/demo_db_backups' by
 # default.
 AppConfig[:demo_db_backup_schedule] = "0 4 * * *"
 AppConfig[:demo_db_backup_number_to_keep] = 7
</code></pre>

<p>Solr indexes can always be recreated from the contents of the
database, but backing them up can reduce your recovery time if
disaster strikes.  You can create periodic Solr snapshots using the
following configuration settings:</p>

<pre><code> # Create one snapshot per hour and keep only one.
 #
 # Solr snapshots are written to 'data/solr_backups' by default.
 AppConfig[:solr_backup_schedule] = "0 * * * *"
 AppConfig[:solr_backup_number_to_keep] = 1
</code></pre>

<h2 id="recovering-from-backup">Recovering from backup</h2>

<p>When recovering an ArchivesSpace installation from backup, you will
need to restore:</p>

<ul>
  <li>
    <p>Your database (either the demo database or MySQL)</p>
  </li>
  <li>
    <p>The search indexes and related indexer files</p>
  </li>
</ul>

<p>Of the two, the database backup is the most crucial–search indexes
are worth restoring if you have backups, but they can be recreated
from scratch if necessary.</p>

<h3 id="recovering-your-database">Recovering your database</h3>

<p>If you are using MySQL, recovering your database just requires loading
your <code>mysqldump</code> backup into an empty database.  If you are using the
<code>scripts/backup.sh</code> script (described above), this dump file is named
<code>mysqldump.sql</code> in your backup <code>.zip</code> file.</p>

<p>To load a MySQL dump file, follow the directions in <em>Set up your MySQL
database</em> to create an empty database with the appropriate
permissions.  Then, populate the database from your backup file using
the MySQL client:</p>

<pre><code>mysql -uarchivesspace -p &lt; mysqldump.sql
</code></pre>

<p>(change the username as required and enter your password when
prompted).</p>

<p>If you are using the demo database, your backup <code>.zip</code> file will
contain a directory called <code>demo_db_backups</code>.  Each subdirectory of
<code>demo_db_backups</code> contains a backup of the demo database.  To
restore from a backup, copy its <code>archivesspace_demo_db</code> directory back
to your ArchivesSpace data directory.  For example:</p>

<pre><code> cp -a /unpacked/zip/demo_db_backups/demo_db_backup_1373323208_25926/archivesspace_demo_db \
       /path/to/archivesspace/data/
</code></pre>

<h3 id="recovering-the-search-indexes-and-related-indexer-files">Recovering the search indexes and related indexer files</h3>

<p>This step is optional since indexes can be rebuilt from the contents
of the database.  However, recovering your search indexes can reduce
the time needed to get your system running again.</p>

<p>The backup <code>.zip</code> file contains two directories used by the
ArchivesSpace indexer:</p>

<ul>
  <li>
    <p>solr.backup-[timestamp]/snapshot.[timestamp] – a snapshot of the
index files.</p>
  </li>
  <li>
    <p>solr.backup-[timestamp]/indexer_state – the files used by the
indexer to remember what it last indexed.</p>
  </li>
</ul>

<p>To restore these directories from backup:</p>

<ul>
  <li>
    <p>Copy your index snapshot to <code>/path/to/archivesspace/data/solr_index/index</code></p>
  </li>
  <li>
    <p>Copy your indexer_state backup to <code>/path/to/archivesspace/data/indexer_state</code></p>
  </li>
</ul>

<p>For example:</p>

<pre><code> mkdir -p /path/to/archivesspace/data/solr_index

 cp -a /unpacked/zip/solr.backup-26475-1373323208/snapshot.20130709084008464 \ 
       /path/to/archivesspace/data/solr_index/index

 cp -a /unpacked/zip/solr.backup-26475-1373323208/indexer_state \ 
       /path/to/archivesspace/data/
</code></pre>


        </main>
      </div><!-- /#content -->

      <footer>
  <div class="row">
  </div>
</footer>

    </div><!-- /.wrapper -->
  </body>
</html>
