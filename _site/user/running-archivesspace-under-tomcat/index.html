<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Running ArchivesSpace under Tomcat - ArchivesSpace</title>
    <link rel="stylesheet" href="/assets/stylesheets/main.css">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" defer></script>
    <script src="/assets/javascripts/site.js" type="text/javascript" charset="utf-8" defer></script>
    <script src="/assets/javascripts/main.js" type="text/javascript" charset="utf-8" defer></script>
    <link rel="alternate" type="application/atom+xml" href="/blog.xml">
  </head>
  <body>
    <div class="wrapper">

      <header class="top">
  <div class="row topbar">
    <h1 id="logo" class="logo">
  <a href="http://archivesspace.org/" title="ArchivesSpace">ArchivesSpace</a>
</h1>

    <nav>
      <ul id="navigation" class="navigation">
        <li><a href="https://archivesspace.atlassian.net/wiki/display/ADC/ArchivesSpace">Wiki</a></li>
        <li><a href="http://docs.archivesspace.org">User Docs</a></li>
        <li class="toggle"><button type="button" id="toggle-menu" class="button--teal">Menu</button></li>
      </ul>
    </nav>
  </div>
</header>


      <div id="content" class="row">

        <div id="sidebar" class="sidebar">
  <div>
    <!-- <h2>Search</h2> -->
    <div class="searchbox">
      <form>
        <input type="text" id="st-search-input" class="searchbox-input" placeholder="Search the docs" />
      </form>
      <script type="text/javascript">
          (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
            (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
            e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
            })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

              _st('install','R97A3uv-TMx4aozWwT1Y','2.0.0');
            </script>
    
    </div>
  </div>
  <!-- <section>
    <h2>Newsletter</h2>
    <div id="mc_embed_signup" style="margin-left: 1.5em; margin-top: 0.5em;">
      <form
         action="http://travis-ci.us7.list-manage.com/subscribe/post?u=8ce724a4c9af4dace663cd39c&amp;id=44f8dff14c"
         method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate"
         target="_blank" novalidate>
        <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required/>
        <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button">
      </form>
    </div>
  </section>
  <section>
    <h2><a href="http://travis-ci.com/?utm_source=docs.travis-ci.org&utm_medium=referral&utm_content=textlink&utm_campaign=docsite_sidebar">Travis CI for Private Repositories</a></h2>
  </section> -->

  <section>
    <h2>Menu</h2>
    <nav>
      <ul>
        <li><a href="/user/system-requirements/">System Requirements</a></li>
        <li><a href="/user/getting-started/">Getting started</a></li>
        <li><a href="/user/configuring-archivesspace/">Configuring ArchivesSpace</a></li>
        <li><a href="/user/upgrading-to-a-new-release-of-archivesspace/">Upgrading ArchivesSpace</a></li>
        <li><a href="/user/running-archivesspace-as-a-unix-daemon/">Running ArchivesSpace as a Unix daemon</a></li>
        <li><a href="/user/running-archivesspace-as-a-windows-service/">Running ArchivesSpace as a Windows Service</a></li>
        <li><a href="/user/running-archivesspace-under-tomcat/">Running ArchivesSpace under Tomcat</a></li>
        <li><a href="/user/running-archivesspace-against-mysql/">Setting up MySQL for Production</a></li>
        <li><a href="/user/backup-and-recovery/">Backup and Recovery</a></li>
        <li><a href="/user/re-creating-indexes/">Re-creating your indexes</a></li>
        <li><a href="/user/resetting-passwords/">Resetting Passwords</a></li>
        <li><a href="/user/configuring-ldap-authentication/">Configuring LDAP authentication</a></li>
        <li><a href="/user/archivesspace-plug-ins-readme/">Plugins and Local Customizations</a></li>
        <li><a href="/user/running-archivesspace-under-a-prefix/">Deploying under a URL prefix</a></li>
        <li><a href="/user/running-archivesspace-with-external-solr/">Using an external Solr index</a></li>
        <li><a href="/user/application-monitoring-with-new-relic/">Monitoring with New Relic</a></li>
      </ul>
      <h2>Developer Guides</h2>
      <ul>
        <li><a href="/user/archivesspace-architecture-overview">Architecture Overview</a></li>
        <li><a href="/api">The API</a></li>
        <li><a href="/user/archivesspace-build-system">Building ArchivesSpace</a></li>
        <li><a href="/user/selenium-test-suite">Running Selenium Tests</a></li>
        <li><a href="/doc">Ruby YARD Documentation</a></li>
        <li><div class="status-circle status">Status:</div>
          <a href="https://travis-ci.org/archivesspace/archivesspace">Travis CI Status</a>
        </li>
      </ul>
    </nav>
  </section>
  <section>
    <h2>Contact</h2>
    <ul>
      <li><a href="https://twitter.com/archivesspace">Twitter</a></li>
      <li><a href="irc://chat.freenode.net/%23archivesspace">IRC</a></li>
      <li><a href="http://github.com/archivesspace">GitHub</a></li>
    </ul>
  </section>
  <section>
    <h2>Contributing</h2>
    <p>This documentation site is open source.
      The <a href="https://github.com/archivesspace/archivesspace/tree/gh-pages">README in our Git repository</a> explains how to contribute.</p>
      <p>This documentation was based on the <a href="https://travis-ci.org">Travis CI</a> documentation. It uses <a href="https://github.com/jekyll/jekyll">Jekyll</a> and <a href="https://github.com/tripit/slate">Slate</a></p>
  </section>
</div><!-- /#sidebar -->


        <main id="main" class="main">
          
            <h1 class="title">Running ArchivesSpace under Tomcat</h2>
          
          <hr />

<p>Before using these intructions, please have a look at the main documentation.
It a good idea to try out ArchivesSpace and be able to have it running in the
standard foreground mode ( using the archivesspace.bat or archivesspace.sh scripts).
Also, be sure to have your database setup and config.rb configured correctly.</p>

<p>ArchivesSpace is packaged as a set of <code>.war</code> files, so you can run it
under any servlet container you like.  Unless you have particular
needs, we recommend you use the standard method described in README.md
(which uses an embedded Jetty container).</p>

<p>However, if you have a burning desire to use Tomcat, the steps are:</p>

<ul>
  <li>
    <p>Download the archivesspace zip distribution, and the Tomcat
distribution.</p>
  </li>
  <li>
    <p>Unpack the archivesspace distribution and modify the
config/config.rb file to point to your MySQL database (if you’re
using MySQL).  Something like:</p>

    <p>AppConfig[:db_url] = “jdbc:mysql://localhost:3306/archivesspace?user=as&amp;password=as123&amp;useUnicode=true&amp;characterEncoding=UTF-8”</p>
  </li>
  <li>
    <p>Also in config/config.rb disable embedded solr and set solr url if you want to use an <a href="README_SOLR.md">external Solr instance</a></p>

    <p>AppConfig[:enable_solr] = false
  AppConfig[:solr_url] = “http://some.solr.org:8983/solr/archivesspace”</p>
  </li>
  <li>
    <p>Unpack the Tomcat distribution</p>
  </li>
  <li>
    <p>From your ‘archivesspace’ directory, use the ‘configure-tomcat.sh’
script to copy everything over to your Tomcat directory</p>
  </li>
  <li>
    <p>Install the MySQL connector into Tomcat’s ‘lib’ directory.</p>
  </li>
</ul>

<p>On my system, that looks like this:</p>

<pre><code> $ ls
 apache-tomcat-7.0.47.tar.gz  archivesspace-v1.1.0.zip

 # Unpack both
 $ tar xf apache-tomcat-7.0.47.tar.gz
 $ unzip -q archivesspace-v1.l.0.zip

 $ cd archivesspace

 (edit config/config.rb to include the AppConfig[:db_url] setting)

 # Now configure the Tomcat directory
 $ scripts/configure-tomcat.sh ../apache-tomcat-7.0.47
 Loading ArchivesSpace configuration file from path: /home/mst/tmp/tomcat/archivesspace/config/config.rb
 Loading ArchivesSpace configuration file from path: /home/mst/tmp/tomcat/archivesspace/config/config.rb
 Copying '/home/mst/tmp/tomcat/archivesspace/wars/backend.war' to '/home/mst/tmp/tomcat/apache-tomcat-7.0.47/webapps-backend/ROOT.war'
 Copying '/home/mst/tmp/tomcat/archivesspace/wars/frontend.war' to '/home/mst/tmp/tomcat/apache-tomcat-7.0.47/webapps-frontend/ROOT.war'
 Copying '/home/mst/tmp/tomcat/archivesspace/wars/public.war' to '/home/mst/tmp/tomcat/apache-tomcat-7.0.47/webapps-public/ROOT.war'
 Copying '/home/mst/tmp/tomcat/archivesspace/wars/indexer.war' to '/home/mst/tmp/tomcat/apache-tomcat-7.0.47/webapps-solr'
 Copying '/home/mst/tmp/tomcat/archivesspace/wars/solr.war' to '/home/mst/tmp/tomcat/apache-tomcat-7.0.47/webapps-solr/ROOT.war'
 Copying '/home/mst/tmp/tomcat/archivesspace/gems/gems/jruby-jars-1.7.6/lib/jruby-core-complete-1.7.6.jar' to '/home/mst/tmp/tomcat/apache-tomcat-7.0.47/lib'
 Copying '/home/mst/tmp/tomcat/archivesspace/gems/gems/jruby-jars-1.7.6/lib/jruby-stdlib-complete-1.7.6.jar' to '/home/mst/tmp/tomcat/apache-tomcat-7.0.47/lib'
 Copying '/home/mst/tmp/tomcat/archivesspace/lib/common.jar' to '/home/mst/tmp/tomcat/apache-tomcat-7.0.47/lib'
 Copying '/home/mst/tmp/tomcat/archivesspace/lib/jsoup-1.7.2.jar' to '/home/mst/tmp/tomcat/apache-tomcat-7.0.47/lib'
 Copying '/home/mst/tmp/tomcat/archivesspace/gems/gems/jruby-rack-1.1.12/lib/jruby-rack-1.1.12.jar' to '/home/mst/tmp/tomcat/apache-tomcat-7.0.47/lib'
 Copying '/home/mst/tmp/tomcat/archivesspace/gems' to '/home/mst/tmp/tomcat/apache-tomcat-7.0.47/lib'
 Copying '/home/mst/tmp/tomcat/archivesspace/locales' to '/home/mst/tmp/tomcat/apache-tomcat-7.0.47'
 Copying '/home/mst/tmp/tomcat/archivesspace/launcher/tomcat/files/setenv.sh' to '/home/mst/tmp/tomcat/apache-tomcat-7.0.47/bin'
 Writing server.xml
 Writing skeleton config file to /home/mst/tmp/tomcat/apache-tomcat-7.0.47/conf/config.rb

 # Grab the MySQL connector and put it somewhere Tomcat can find it
 $ cd ../apache-tomcat-7.0.47/lib
 $ curl -Oq http://repo1.maven.org/maven2/mysql/mysql-connector-java/5.1.24/mysql-connector-java-5.1.24.jar

 # Start Tomcat
 $ cd ../
 $ bin/startup.sh
</code></pre>

<p>If you left the ports as default in your config/config.rb file, you
should be able to connect to ArchivesSpace on http://localhost:8080/ at
this point (and the logs/catalina.out file will confirm that everything
started up)</p>

<h2 id="running-archivesspace-under-tomcat-as-a-windows-service">Running ArchivesSpace under Tomcat as a Windows service</h2>

<p>The primary README contains a refrence to the following error:</p>

<p>“Note: If you’re running Windows and you get an error message like unable to resolve type ‘size_t’ or no such file to load – bundler, make sure that there are no spaces in any part of the path name in which the ArchivesSpace directory is located.”</p>

<p>This also applies to Tomcat on Windows.  The default installation for Tomcat on Windows contains many spaces (ie, Program Files, Tomcat 7.0, etc).  You should install Tomcat to a folder without spaces, C:\Tomcat for example.</p>

<p>You can  use Tomcat to run ArchivesSpace as a Windows service.
Start by following the steps above to install ArchivesSpace into your
Tomcat directory (using <code>scripts\configure-tomcat.bat</code> instead of
<code>scripts/configure-tomcat.sh</code>).  Make sure you get the release
specifically for Windows (marked with something like “64-bit Windows
zip”).</p>

<p>Once Tomcat is ready, open a command prompt as the administrator
user.  You can do that by right-clicking on cmd.exe and selecting “Run
as administrator” or, in recent versions of Windows, by selecting
“Open command prompt as administrator” from the “File” menu of any
explorer window.</p>

<p><img src="docs/images/console_run_as_admin.png" alt="Run as admin" /></p>

<p><img src="docs/images/console_run_as_admin_win8.png" alt="Run as admin (from Explorer)" /></p>

<p>From the command prompt, switch to your Tomcat directory.  I’m using
Tomcat8 to ensure compatibility with Windows 8, but Tomcat7 should be
fine.</p>

<pre><code> &gt; cd c:\aspace\apache-tomcat-8.0.0-RC5
</code></pre>

<p>Now use Tomcat’s <code>service.bat</code> script to install Tomcat as a Windows
service with a nice name:</p>

<pre><code> # If you don't have a service.bat file, check that you got the
 # Windows release of Tomcat.
 &gt; bin\service.bat install ArchivesSpace
</code></pre>

<p><img src="docs/images/console_installed_service.png" alt="Service created" /></p>

<p>Before we can start the service, we will need to configure its memory
allocations.  To do this, run the Tomcat monitor program:</p>

<pre><code> # Use tomcat7w.exe if you're using Tomcat 7
 &gt; bin\tomcat8w.exe //MS//ArchivesSpace
</code></pre>

<p>That command won’t print anything, but you’ll notice a small icon
appear in your taskbar:</p>

<p><img src="docs/images/tomcat_icon.png" alt="Tomcat configuration taskbar icon" /></p>

<p>Right-click that icon and select <code>Configure...</code>.  A window will appear
that looks something like this:</p>

<p><img src="docs/images/tomcat_window.png" alt="The Tomcat configuration window" /></p>

<p>Click the <code>Java</code> tab and you’ll see three settings for memory pools.
Set them as follows:</p>

<ul>
  <li><strong>Initial memory pool</strong>: 1024</li>
  <li><strong>Maximum memory pool</strong>: 1024</li>
  <li><strong>Thread stack size</strong>: 2048</li>
</ul>

<p>I’ve occasionally had some trouble getting these pool settings to
stick.  Lovers of small text boxes will have already noticed the <code>Java
Options</code> box, so let’s add the equivalent Java options to the bottom
of that (one option per line):</p>

<pre><code> -Xms1024m
 -Xmx1024m
 -Xss2m
 -verbose:gc
 -XX:MaxPermSize=256m
</code></pre>

<p>The resulting settings should look like this:</p>

<p><img src="docs/images/tomcat_settings.png" alt="Tomcat memory settings" /></p>

<p>Click <code>OK</code> to confirm everything and close the window.  Time to start
it up!</p>

<p>From the <code>Control Panel</code>, find your way to <code>Administrative Tools</code>, and
then to <code>Services</code>.  Near the top of the list you should see <code>Apache
Tomcat ArchivesSpace</code>.  Here you can change the service properties to
have it automatically start on boot, or just start the service
manually:</p>

<p><img src="docs/images/aspace_service.png" alt="Our new Windows service" /></p>

<p>You’ll find some log files written to the <code>logs</code> directory of your
Tomcat directory.  Generally the ones starting with <code>archivesspace</code>
are the most useful.</p>

        </main>
      </div><!-- /#content -->

      <footer>
  <div class="row">
  </div>
</footer>

    </div><!-- /.wrapper -->
  </body>
</html>
