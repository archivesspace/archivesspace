<%= setup_context :title => @manage_access ? I18n.t("user._frontend.section.manage_access") : I18n.t("user._plural") %>

<div class="row">
   <div class="col-md-3"></div>
   <div class="col-md-9">
     <% if not @manage_access %>

       <div class="record-toolbar">
         <div class="btn-group pull-right">
           <% if params[:show_inactive] %>
             <%= link_to I18n.t('user._frontend.action.hide_inactive'), {  :controller => :users }, :class => "btn btn-sm btn-default"   %>
           <% else %>
             <%= link_to I18n.t('user._frontend.action.show_inactive'), {  :controller => :users, :show_inactive => true }, :class => "btn btn-sm btn-default"   %>
           <% end %>
           <%= link_to I18n.t("user._frontend.action.create"), {:controller => :users, :action => :new}, :class => "btn btn-sm btn-default" %>
         </div>
         <br style="clear:both" /> <!-- So dirty! -->
       </div>

     <% end %>

    <div class="record-pane">
      <% if @manage_access %>
        <%= link_to_help :topic => "repository_users" %>
        <h2><%= I18n.t("user._frontend.section.manage_access") %></h2>
      <% else %>
        <%= link_to_help :topic => "user" %>
        <h2><%= I18n.t("user._plural") %></h2>
      <% end %>

      <%= render_aspace_partial :partial => "shared/flash_messages" %>

     <% if @search_data['results'].length %>
       <table class="table table-striped table-bordered table-condensed">
         <thead>
           <tr>
             <th><%= I18n.t("user.is_active_user") %></th>
             <th>
              <%= link_to I18n.t("user.username"), sort: :username, direction: sort_direction(:username, params, 'asc') %>
              <%= sort_pointer(:username, params, '&#x25B2;').html_safe %>
             </th>
             <th><%= I18n.t("user.name") %></th>
             <th>
              <%= link_to I18n.t("user.create_time"), sort: :create_time, direction: sort_direction(:create_time, params, 'asc') %>
              <%= sort_pointer(:create_time, params, '').html_safe %>
             </th>
             <th>
              <%= link_to I18n.t("user.user_mtime"), sort: :user_mtime, direction: sort_direction(:user_mtime, params, 'desc') %>
              <%= sort_pointer(:user_mtime, params, '').html_safe %>
             </th>
             <th><%= I18n.t("user.admin") %></th>
             <th width="70px"><span class="sr-only"><%= I18n.t('search_results.actions') %></span></th>
           </tr>
         </thead>
         <tbody>
           <% @search_data['results'].each do |user| %>
             <tr>
               <td>
                 <% if user.is_active_user %>
                   <span class="glyphicon glyphicon-check" aria-hidden="true"></span>
                 <% else %>
                   <span class="glyphicon glyphicon-ban-circle" aria-hidden="true"></span>
                 <% end %>
               </td>
               <td><%= user.username %></td>
               <td><%= user.name %></td>
               <td><%= Time.parse(user.create_time).getlocal %></td>
               <td><%= Time.parse(user.user_mtime).getlocal %></td>
               <td><%= user.is_admin %></td>
               <td>
                 <div class="btn-group" style="float: right">
                   <% if @manage_access; disabled = user.is_admin ? " disabled" : "" %>
                      <%= link_to I18n.t("actions.edit_groups"), {:controller => :users, :action => :edit_groups, :id => user.id}, :class => "btn btn-xs btn-default".concat(disabled) %>
                   <% else %>
                      <% if !user.is_active_user && !user.is_system_user %>
                        <%= link_to I18n.t("user._frontend.action.activate_user"), user_activate_path(user.id), :confirm => "Are you sure?", :class => "btn btn-xs btn-danger" %>
                      <% elsif !user.is_system_user %>
                        <%= link_to I18n.t("user._frontend.action.deactivate_user"), user_deactivate_path(user.id), :confirm => "Are you sure?", :class => "btn btn-xs btn-danger" %>
                      <% end %>
                    <%= link_to I18n.t("actions.edit"), {:controller => :users, :action => :edit, :id => user.id}, :class => "btn btn-xs btn-primary" %>
                   <% end %>
                 </div>
               </td>
             </tr>           
           <% end %>
         </tbody>
       </table>
       <%= render_aspace_partial :partial => "shared/pagination" %>
     <% else %>
       <p class="alert alert-info">
         No Users.
       </p>
     <% end %>
     </div>
   </div>
</div>
