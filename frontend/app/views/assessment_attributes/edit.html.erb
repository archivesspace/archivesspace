<%= setup_context(:title => I18n.t('assessment_attribute_definitions._frontend.title')) %>

<%= form_for @assessment_attribute_definitions, :as => "assessment_attribute_definitions", :url => {:action => :update}, :html => {:class => 'form-horizontal aspace-record-form', :id => "assessment_attributes_form"} do |f| %>
  <%= form_context :assessment_attribute_definitions, @assessment_attribute_definitions do |form| %>
    <div class="row">
      <div class="col-md-3">
        <%= render_aspace_partial :partial => "sidebar" %>
      </div>

      <div class="col-md-9">
        <div class="record-pane">
          <h2><%= I18n.t('assessment_attribute_definitions._frontend.title') %></h2>

          <%= render_aspace_partial :partial => "shared/form_messages", :locals => {:object => @assessment_attribute_definitions, :form => form} %>

          <h3 id="ratings"><%= I18n.t('assessment_attribute_definitions._frontend.section.ratings') %></h3>

          <table class="table table-bordered table-striped">
            <thead>
            <tr>
              <th colspan="2"><%= I18n.t('assessment_attribute_definitions._frontend.global', :type => I18n.t('assessment_attribute_definitions._frontend.section.ratings')) %></th>
            </tr>
            <tr>
              <th class="col-xs-6"><%= I18n.t('assessment_attribute_definitions._frontend.database_value')%></th>
              <th class="col-xs-6"><%= I18n.t('assessment_attribute_definitions._frontend.translation')%></th>
            </tr>
            </thead>
            <tbody>
            <% @assessment_attribute_definitions.global_ratings.each do |rating| %>
              <tr>
                <td>
                  <a class="btn btn-sm" target="_blank" href="<%= url_for :controller => :search, :action => :do_search, :type => 'assessment', :q => "assessment_ratings:\"#{rating.fetch('label')}\"" %>">
                    <span class="glyphicon glyphicon-search"></span>
                  </a>
                  <%= rating.fetch('label') %>
                </td>
                <td><%= I18n.t("assessment_attribute.rating.#{rating.fetch('label')}", :default => rating.fetch('label')) %></td>
              </tr>
            <% end %>
            </tbody>
            <thead>
            <tr>
              <th colspan="2"><%= I18n.t('assessment_attribute_definitions._frontend.repository', :type => I18n.t('assessment_attribute_definitions._frontend.section.ratings')) %></th>
            </tr>
            </thead>
            <tbody class="repository-attributes">
              <% @assessment_attribute_definitions.repo_ratings.each do |rating| %>
                <tr>
                  <td colspan="2">
                    <div class="input-group">
                      <span class="input-group-addon repo-attribute-drag-handle">
                        <span class="glyphicon glyphicon-menu-hamburger"></span>
                      </span>
                      <span class="input-group-addon repo-attribute-search">
                        <a target="_blank" href="<%= url_for :controller => :search, :action => :do_search, :type => 'assessment', :q => "assessment_ratings:\"#{rating.fetch('label')}\"" %>">
                          <span class="glyphicon glyphicon-search"></span>
                        </a>
                      </span>
                      <%= text_field_tag 'ratings[][label]', rating.fetch('label'), :class => 'form-control' %>
                      <span class="input-group-btn">
                        <button class="btn btn-danger remove-repo-attribute"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
                      </span>
                    </div>
                    <%= hidden_field_tag 'ratings[][id]', rating.fetch('id', nil) %>
                    <%= hidden_field_tag 'ratings[][type]', 'rating' %>
                  </td>
                </tr>
              <% end %>
            </tbody>
            <tbody>
              <tr>
                <td colspan="2">
                  <button class="btn btn-sm btn-success add-repo-attribute" data-type="rating"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button>
                </td>
              </tr>
            </tbody>
          </table>

          <h3 id="formats"><%= I18n.t('assessment_attribute_definitions._frontend.section.formats') %></h3>

          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th colspan="2"><%= I18n.t('assessment_attribute_definitions._frontend.global', :type => I18n.t('assessment_attribute_definitions._frontend.section.formats')) %></th>
              </tr>
              <tr>
                <th><%= I18n.t('assessment_attribute_definitions._frontend.database_value')%></th>
                <th><%= I18n.t('assessment_attribute_definitions._frontend.translation')%></th>
              </tr>
            </thead>
            <tbody>
              <% @assessment_attribute_definitions.global_formats.each do |format| %>
                <tr>
                  <td>
                    <a class="btn btn-sm" target="_blank" href="<%= url_for :controller => :search, :action => :do_search, :type => 'assessment', :q => "assessment_formats:\"#{format.fetch('label')}\"" %>">
                    <span class="glyphicon glyphicon-search"></span>
                    </a>
                    <%= format.fetch('label') %>
                  </td>
                  <td><%= I18n.t("assessment_attribute.format.#{format.fetch('label')}", :default => format.fetch('label')) %></td>
                </tr>
              <% end %>
            </tbody>
            <thead>
              <tr>
                <th colspan="2"><%= I18n.t('assessment_attribute_definitions._frontend.repository', :type => I18n.t('assessment_attribute_definitions._frontend.section.formats')) %></th>
              </tr>
            </thead>
            <tbody class="repository-attributes">
              <% @assessment_attribute_definitions.repo_formats.each do |format| %>
                <tr>
                  <td colspan="2">
                    <div class="input-group">
                      <span class="input-group-addon repo-attribute-drag-handle">
                        <span class="glyphicon glyphicon-menu-hamburger"></span>
                      </span>
                      <span class="input-group-addon repo-attribute-search">
                        <a target="_blank" href="<%= url_for :controller => :search, :action => :do_search, :type => 'assessment', :q => "assessment_formats:\"#{format.fetch('label')}\"" %>">
                          <span class="glyphicon glyphicon-search"></span>
                        </a>
                      </span>
                      <%= text_field_tag 'formats[][label]', format.fetch('label'), :class => 'form-control' %>
                      <span class="input-group-btn">
                        <button class="btn btn-danger remove-repo-attribute"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
                      </span>
                    </div>
                    <%= hidden_field_tag 'formats[][id]', format.fetch('id', nil) %>
                    <%= hidden_field_tag 'formats[][type]', 'format' %>
                  </td>
                </tr>
              <% end %>
            </tbody>
            <tbody>
              <tr>
                <td colspan="2">
                  <button class="btn btn-sm btn-success add-repo-attribute" data-type="format"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button>
                </td>
              </tr>
            </tbody>
          </table>

          <h3 id="conservation_issues"><%= I18n.t('assessment_attribute_definitions._frontend.section.conservation_issues') %></h3>

          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th colspan="2"><%= I18n.t('assessment_attribute_definitions._frontend.global', :type => I18n.t('assessment_attribute_definitions._frontend.section.conservation_issues')) %></th>
              </tr>
              <tr>
                <th><%= I18n.t('assessment_attribute_definitions._frontend.database_value')%></th>
                <th><%= I18n.t('assessment_attribute_definitions._frontend.translation')%></th>
              </tr>
            </thead>
            <tbody>
              <% @assessment_attribute_definitions.global_conservation_issues.each do |conservation_issue| %>
                <tr>
                  <td>
                    <a class="btn btn-sm" target="_blank" href="<%= url_for :controller => :search, :action => :do_search, :type => 'assessment', :q => "assessment_conservation_issues:\"#{conservation_issue.fetch('label')}\"" %>">
                      <span class="glyphicon glyphicon-search"></span>
                    </a>
                    <%= conservation_issue.fetch('label') %>
                  </td>
                  <td><%= I18n.t("assessment_attribute.conservation_issue.#{conservation_issue.fetch('label')}", :default => conservation_issue.fetch('label')) %></td>
                </tr>
              <% end %>
            </tbody>
            <thead>
              <tr>
                <th colspan="2"><%= I18n.t('assessment_attribute_definitions._frontend.repository', :type => I18n.t('assessment_attribute_definitions._frontend.section.conservation_issues')) %></th>
              </tr>
            </thead>
            <tbody class="repository-attributes">
              <% @assessment_attribute_definitions.repo_conservation_issues.each do |conservation_issue| %>
                <tr>
                  <td colspan="2">
                    <div class="input-group">
                      <span class="input-group-addon repo-attribute-drag-handle">
                        <span class="glyphicon glyphicon-menu-hamburger"></span>
                      </span>
                      <span class="input-group-addon repo-attribute-search">
                        <a target="_blank" href="<%= url_for :controller => :search, :action => :do_search, :type => 'assessment', :q => "assessment_conservation_issues:\"#{conservation_issue.fetch('label')}\"" %>">
                          <span class="glyphicon glyphicon-search"></span>
                        </a>
                      </span>
                      <%= text_field_tag 'conservation_issues[][label]', conservation_issue.fetch('label'), :class => 'form-control' %>
                      <span class="input-group-btn">
                        <button class="btn btn-danger remove-repo-attribute"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
                      </span>
                    </div>
                    <%= hidden_field_tag 'conservation_issues[][id]', conservation_issue.fetch('id', nil) %>
                    <%= hidden_field_tag 'conservation_issues[][type]', 'conservation_issue' %>
                  </td>
                </tr>
              <% end %>
            </tbody>
            <tbody>
              <tr>
                <td colspan="2">
                  <button class="btn btn-sm btn-success add-repo-attribute" data-type="conservation_issue"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button>
                </td>
              </tr>
            </tbody>
          </table>

          <hr>

          <div class="form-actions">
            <button type="submit" class="btn btn-primary"><%= I18n.t("assessment_attribute_definitions._frontend.action.save") %></button>
            <%= link_to I18n.t("actions.cancel"), :back, :class => "btn btn-cancel btn-default" %>
          </div>
        </div>
      </div>
    </div>
  <% end %>
<% end %>

<script id="template_format" type="text/template">
  <tr>
    <td colspan="2">
      <div class="input-group">
        <span class="input-group-addon repo-attribute-drag-handle">
          <span class="glyphicon glyphicon-menu-hamburger"></span>
        </span>
        <%= text_field_tag 'formats[][label]', '', :class => 'form-control' %>
        <span class="input-group-btn">
          <button class="btn btn-danger remove-repo-attribute"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
        </span>
      </div>
    </td>
  </tr>
</script>
<script id="template_rating" type="text/template">
  <tr>
    <td colspan="2">
      <div class="input-group">
        <span class="input-group-addon repo-attribute-drag-handle">
          <span class="glyphicon glyphicon-menu-hamburger"></span>
        </span>
        <%= text_field_tag 'ratings[][label]', '', :class => 'form-control' %>
        <span class="input-group-btn">
          <button class="btn btn-danger remove-repo-attribute"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
        </span>
      </div>
    </td>
  </tr>
</script>
<script id="template_conservation_issue" type="text/template">
  <tr>
    <td colspan="2">
      <div class="input-group">
        <span class="input-group-addon repo-attribute-drag-handle">
          <span class="glyphicon glyphicon-menu-hamburger"></span>
        </span>
        <%= text_field_tag 'conservation_issues[][label]', '', :class => 'form-control' %>
        <span class="input-group-btn">
          <button class="btn btn-danger remove-repo-attribute"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
        </span>
      </div>
    </td>
  </tr>
</script>
