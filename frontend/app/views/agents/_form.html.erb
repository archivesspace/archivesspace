<%= render_aspace_partial :partial => "shared/form_messages", :locals => {:object => @agent, :form => form} %>

<%= render_aspace_partial :partial => "agents/contact_details", :locals => {:form => form} %>

<% if AppConfig[:agents_display_full] == false || !@full_mode %>
  <% invisible = true %>
<% else %>
  <% invisible = false %>
<% end %>

<% if invisible && 
      (@agent.agent_record_controls.length > 0 ||
      @agent.agent_other_agency_codes.length > 0 ||
      @agent.agent_conventions_declarations.length > 0 ||
      @agent.agent_maintenance_histories.length > 0 ||
      @agent.agent_sources.length > 0 ||
      @agent.agent_alternate_sets.length > 0 ||
      @agent.agent_genders.length > 0 ||
      @agent.agent_places.length > 0 ||
      @agent.agent_occupations.length > 0 ||
      @agent.agent_functions.length > 0 ||
      @agent.agent_topics.length > 0 ||
      @agent.used_languages.length > 0 ||
      @agent.agent_resources.length > 0) %>
  <div class="alert alert-warning">This agent has data that is only editable in Full mode. To enable it, ask your administrator to enable Full Mode on this instance and grant you Full Mode permission.</div>
<% end %>

<fieldset>
  <section id="basic_information">
    <h3>
      <%= I18n.t("agent._frontend.section.basic_information") %>
      <%= link_to_help :topic => "#{@agent.agent_type}_basic_information" %>
    </h3>
    <div class="form-group">
      <label class="col-sm-2 control-label"><%= I18n.t("agent.type") %></label>
      <div class="col-sm-9 label-only">
        <%= form.hidden_input "agent_type", @agent.agent_type %>
        <strong><%= I18n.t("agent.agent_type.#{@agent.agent_type}") %></strong>
      </div>
    </div>

    <%= render_aspace_partial :partial => "shared/slug", :locals => {:form => form, :record_type => @agent} if AppConfig[:use_human_readable_urls] %>

    <%= form.label_and_boolean "publish" %>

  </section>

  <section id="record_control_information" class="agents-subsection">
    <h3>
      <%= I18n.t("agent._frontend.section.record_control_information") %>
    </h3>

   <%= render_aspace_partial :partial => "shared/subrecord_form", :locals => {:form => form, :name => "agent_record_identifiers", :section_id => "#{@agent.agent_type}_agent_record_identifier", :template => "agent_record_identifiers", help_topic: "agent_record_identifiers", :invisible => false} %>

   <%= render_aspace_partial :partial => "shared/subrecord_form", :locals => {:form => form, :name => "agent_record_controls", :section_id => "#{@agent.agent_type}_agent_record_control", :template => "agent_record_control", help_topic: "agent_record_controls", :cardinality => :zero_to_one, :list_limited_to_one => true, :invisible => invisible} %>

   <%= render_aspace_partial :partial => "shared/subrecord_form", :locals => {:form => form, :name => "agent_other_agency_codes", :section_id => "#{@agent.agent_type}_agent_other_agency_codes", :template => "agent_other_agency_codes", help_topic: "agent_other_agency_codes", :invisible => invisible} %>

   <%= render_aspace_partial :partial => "shared/subrecord_form", :locals => {:form => form, :name => "agent_conventions_declarations", :section_id => "#{@agent.agent_type}_agent_conventions_declaration", :template => "agent_conventions_declaration", help_topic: "agent_conventions_declarations", :invisible => invisible} %>

   <%= render_aspace_partial :partial => "shared/subrecord_form", :locals => {:form => form, :name => "agent_maintenance_histories", :section_id => "#{@agent.agent_type}_agent_maintenance_history", :template => "agent_maintenance_histories", help_topic: "agent_maintenance_histories", :invisible => invisible} %>

   <%= render_aspace_partial :partial => "shared/subrecord_form", :locals => {:form => form, :name => "agent_sources", :section_id => "#{@agent.agent_type}_agent_sources", :template => "agent_sources", help_topic: "agent_sources", :invisible => invisible } %>

   <%= render_aspace_partial :partial => "shared/subrecord_form", :locals => {:form => form, :name => "agent_alternate_sets", :section_id => "#{@agent.agent_type}_agent_alternate_set", :template => "agent_alternate_set", help_topic: "agent_alternate_sets", :invisible => invisible} %>
  </section>

  <section id="identity_information" class="agents-subsection">
    <h3>
      <%= I18n.t("agent._frontend.section.identity_information") %>
    </h3>

   <%= render_aspace_partial :partial => "shared/subrecord_form", :locals => {:form => form, :name => "agent_identifiers", :section_id => "#{@agent.agent_type}_agent_identifier", :template => "agent_identifiers", help_topic: "agent_identifiers", :invisible => false} %>

  <%= render_aspace_partial :partial => "shared/subrecord_form", :locals => {:form => form, :name => "names", :section_id => "#{@agent.agent_type}_names", :template_erb => "agents/name_forms/#{@agent.agent_type}", :template => "name_#{@agent.agent_type.to_s.gsub("agent_","")}", :help_topic => "#{@agent.agent_type}_names", :invisible => false} %>
  </section>

  <section id="description_information"  class="agents-subsection">
    <h3>
      <%= I18n.t("agent._frontend.section.description_information") %>
    </h3>


  <%= render_aspace_partial :partial => "shared/subrecord_form", :locals => {:form => form, :name => "dates_of_existence", :section_id => "#{@agent.agent_type}_dates_of_existence", :template_erb => "dates/template", :template => "structured_date_label", :heading_text => I18n.t("agent._frontend.section.dates_of_existence"), :template_overrides => {"date_label" => "agents/date_labels"}, :help_topic => "#{@agent.agent_type}_dates_of_existence", :invisible => false} %>


     <% if @agent.agent_type.to_s == "agent_person" %>
       <%= render_aspace_partial :partial => "shared/subrecord_form", :locals => {:form => form, :name => "agent_genders", :section_id => "#{@agent.agent_type}_agent_gender", :template => "agent_gender", help_topic: "agent_genders", :invisible => invisible} %>
     <% end %>

    <%= render_aspace_partial :partial => "shared/subrecord_form", :locals => {:form => form, :name => "agent_places", :section_id => "#{@agent.agent_type}_agent_place", :template => "agent_place", help_topic: "agent_places", :invisible => invisible} %>

    <%= render_aspace_partial :partial => "shared/subrecord_form", :locals => {:form => form, :name => "agent_occupations", :section_id => "#{@agent.agent_type}_agent_occupation", :template => "agent_occupation", help_topic: "agent_occupation", :invisible => invisible} %>

    <%= render_aspace_partial :partial => "shared/subrecord_form", :locals => {:form => form, :name => "agent_functions", :section_id => "#{@agent.agent_type}_agent_function", :template => "agent_function", help_topic: "agent_function", :invisible => invisible} %>

    <%= render_aspace_partial :partial => "shared/subrecord_form", :locals => {:form => form, :name => "agent_topics", :section_id => "#{@agent.agent_type}_agent_topic", :template => "agent_topic", help_topic: "agent_topic", :invisible => invisible} %>

    <%= render_aspace_partial :partial => "shared/subrecord_form", :locals => {:form => form, :name => "used_languages", :section_id => "#{@agent.agent_type}_used_language", :template => "used_language", :invisible => invisible} %>

  <% if user_can?('view_agent_contact_record') %>
    <%= render_aspace_partial :partial => "shared/subrecord_form", :locals => {:form => form, :name => "agent_contacts", :section_id => "#{@agent.agent_type}_contact_details", :template_erb => "agents/contact_details", :template => "agent_contact", :help_topic => "#{@agent.agent_type}_contact_details", :invisible => false} %>
  <% end %>

  <%= render_aspace_partial :partial => "notes/form", :locals => {:form => form, :all_note_types => note_types_for(form['jsonmodel_type']), :section_id => "#{@agent.agent_type}_notes", :show_apply_note_order_action => false} %>

  <%= render_aspace_partial :partial => "shared/subrecord_form", :locals => {:form => form, :name => "external_documents", :section_id => "#{@agent.agent_type}_external_documents", :help_topic => "#{@agent.agent_type}_external_documents", :invisible => false} %>
  </section>

  <section id="relation_information" class="agents-subsection">
    <h3>
      <%= I18n.t("agent._frontend.section.relation_information") %>
    </h3>

    <%= render_aspace_partial :partial => "shared/subrecord_form", :locals => {:form => form, :name => "agent_resources", :section_id => "#{@agent.agent_type}_agent_resource", :template => "agent_resource", help_topic: "agent_resource", :invisible => invisible} %>

  <% unless @agent.agent_type.to_s == "agent_software" %>
    <%= render_aspace_partial :partial => "related_agents/form", :locals => {:form => form} %>
  <% end %>
  
  <%= render_aspace_partial :partial => "shared/subrecord_form", :locals => {:form => form, :name => "external_ids", :hidden => true} %>
  </section>

<%= form_plugins_for("agent", form) %>

</fieldset>
