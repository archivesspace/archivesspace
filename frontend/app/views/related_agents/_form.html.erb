<%= render :partial => "related_agents/template" %>

<% @agent_type = form['agent_type'] %>
<% define_template "related_agents_#{@agent_type}", jsonmodel_definition(@agent_type.intern) do |form|  %>

<section id="related_agents" class="subrecord-form">
  <h3 class="subrecord-form-heading">
    <%= I18n.t("related_agent._plural") %>
    <button class="btn btn-small add-related-agent-for-type-btn pull-right"><%= I18n.t("actions.add") %> <%= I18n.t("related_agent._singular") %></button>
  </h3>

  <div id="related-agents-container" class="subrecord-form-container">
    <%= form.list_for(form["related_agents"], "related_agents[]") do |related_agent| %>
      <% form.emit_template(related_agent["jsonmodel_type"]) %>
    <% end %>
  </div>

</section>
<% end %>

<% form.emit_template("related_agents_#{@agent_type}") %>
