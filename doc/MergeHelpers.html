<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: MergeHelpers
  
    &mdash; Documentation by YARD 0.9.36
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "MergeHelpers";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index (M)</a> &raquo;
    
    
    <span class="title">MergeHelpers</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: MergeHelpers
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>backend/app/lib/merge_helpers.rb</dd>
  </dl>
  
</div>








  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#check_repository-instance_method" title="#check_repository (instance method)">#<strong>check_repository</strong>(merge_destination, merge_candidates, repo_id)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ensure_type-instance_method" title="#ensure_type (instance method)">#<strong>ensure_type</strong>(merge_destination, merge_candidates, type)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_subrec_index_in_merge_candidate-instance_method" title="#find_subrec_index_in_merge_candidate (instance method)">#<strong>find_subrec_index_in_merge_candidate</strong>(merge_candidate, subrec_name, position)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>we don’t know how the user reordered the subrecords on the merge form, so find the index with the right data given the position of the right thing to replace/add by searching for it.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#merge_details-instance_method" title="#merge_details (instance method)">#<strong>merge_details</strong>(merge_destination, merge_candidate, selections, params)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#merge_details_replace_field-instance_method" title="#merge_details_replace_field (instance method)">#<strong>merge_details_replace_field</strong>(merge_destination, merge_candidate, selections, values)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>do field replace operations.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#merge_details_subrec-instance_method" title="#merge_details_subrec (instance method)">#<strong>merge_details_subrec</strong>(merge_destination, merge_candidate, selections, values)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>do subrec replace operations.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parse_references-instance_method" title="#parse_references (instance method)">#<strong>parse_references</strong>(request)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parse_selections-instance_method" title="#parse_selections (instance method)">#<strong>parse_selections</strong>(selections, path = [], all_values = {})  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#preview_sort_name-instance_method" title="#preview_sort_name (instance method)">#<strong>preview_sort_name</strong>(merge_destination)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>NOTE: this code is a duplicate of the auto_generate code for creating sort name in the name_person, name_family, name_software, name_corporate_entity models Consider refactoring when continued work done on the agents model enhancements.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process_subrecord_for_merge-instance_method" title="#process_subrecord_for_merge (instance method)">#<strong>process_subrecord_for_merge</strong>(merge_destination, subrecord, jsonmodel_type, mode, ind)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>before we can merge a subrecord, we need to update the IDs, tweak things to prevent validation issues, etc.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_agent_id-instance_method" title="#set_agent_id (instance method)">#<strong>set_agent_id</strong>(merge_destination_id, subrecord)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>when merging, set the agent id foreign key (e.g, agent_person_id, agent_family_id…) from the merge_candidate to the merge_destination.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="check_repository-instance_method">
  
    #<strong>check_repository</strong>(merge_destination, merge_candidates, repo_id)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="BadParamsException.html" title="BadParamsException (class)">BadParamsException</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


9
10
11
12
13
14
15</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'backend/app/lib/merge_helpers.rb', line 9</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_check_repository identifier id'>check_repository</span><span class='lparen token'>(</span><span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='comma token'>,</span> <span class='rubyid_merge_candidates identifier id'>merge_candidates</span><span class='comma token'>,</span> <span class='rubyid_repo_id identifier id'>repo_id</span><span class='rparen token'>)</span>
  <span class='rubyid_repo_uri identifier id'>repo_uri</span> <span class='assign token'>=</span> <span class='rubyid_JSONModel constant id'>JSONModel</span><span class='lparen token'>(</span><span class='symbol val'>:repository</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_uri_for identifier id'>uri_for</span><span class='lparen token'>(</span><span class='rubyid_repo_id identifier id'>repo_id</span><span class='rparen token'>)</span>

  <span class='rubyid_if if kw'>if</span> <span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='rbrack token'>]</span> <span class='plus op'>+</span> <span class='rubyid_merge_candidates identifier id'>merge_candidates</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_any? fid id'>any?</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_r identifier id'>r</span><span class='bitor op'>|</span> <span class='rubyid_r identifier id'>r</span><span class='lbrack token'>[</span><span class='symbol val'>:repository</span><span class='rbrack token'>]</span> <span class='neq op'>!=</span> <span class='rubyid_repo_uri identifier id'>repo_uri</span><span class='rbrace token'>}</span>
    <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_BadParamsException constant id'>BadParamsException</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:merge_request</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='string val'>&quot;All records to merge must be in the repository specified&quot;</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="ensure_type-instance_method">
  
    #<strong>ensure_type</strong>(merge_destination, merge_candidates, type)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="BadParamsException.html" title="BadParamsException (class)">BadParamsException</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


18
19
20
21
22</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'backend/app/lib/merge_helpers.rb', line 18</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_ensure_type identifier id'>ensure_type</span><span class='lparen token'>(</span><span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='comma token'>,</span> <span class='rubyid_merge_candidates identifier id'>merge_candidates</span><span class='comma token'>,</span> <span class='rubyid_type identifier id'>type</span><span class='rparen token'>)</span>
  <span class='rubyid_if if kw'>if</span> <span class='lparen token'>(</span><span class='rubyid_merge_candidates identifier id'>merge_candidates</span><span class='dot token'>.</span><span class='rubyid_map identifier id'>map</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_r identifier id'>r</span><span class='bitor op'>|</span> <span class='rubyid_r identifier id'>r</span><span class='lbrack token'>[</span><span class='symbol val'>:type</span><span class='rbrack token'>]</span><span class='rbrace token'>}</span> <span class='plus op'>+</span> <span class='lbrack token'>[</span><span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='symbol val'>:type</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_any? fid id'>any?</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_t identifier id'>t</span><span class='bitor op'>|</span> <span class='rubyid_t identifier id'>t</span> <span class='neq op'>!=</span> <span class='rubyid_type identifier id'>type</span><span class='rbrace token'>}</span>
    <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_BadParamsException constant id'>BadParamsException</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:merge_request</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>&quot;This merge request can only merge #{type} records&quot;</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="find_subrec_index_in_merge_candidate-instance_method">
  
    #<strong>find_subrec_index_in_merge_candidate</strong>(merge_candidate, subrec_name, position)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>we don’t know how the user reordered the subrecords on the merge form,
so find the index with the right data given the position of the right thing to replace/add by searching for it.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


183
184
185
186
187
188
189
190
191
192
193</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'backend/app/lib/merge_helpers.rb', line 183</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_find_subrec_index_in_merge_candidate identifier id'>find_subrec_index_in_merge_candidate</span><span class='lparen token'>(</span><span class='rubyid_merge_candidate identifier id'>merge_candidate</span><span class='comma token'>,</span> <span class='rubyid_subrec_name identifier id'>subrec_name</span><span class='comma token'>,</span> <span class='rubyid_position identifier id'>position</span><span class='rparen token'>)</span>
  <span class='rubyid_ind identifier id'>ind</span> <span class='assign token'>=</span> <span class='rubyid_nil nil kw'>nil</span>
  <span class='rubyid_merge_candidate identifier id'>merge_candidate</span><span class='lbrack token'>[</span><span class='rubyid_subrec_name identifier id'>subrec_name</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_each_with_index identifier id'>each_with_index</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_subrec identifier id'>subrec</span><span class='comma token'>,</span> <span class='rubyid_i identifier id'>i</span><span class='bitor op'>|</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_i identifier id'>i</span> <span class='eq op'>==</span> <span class='rubyid_position identifier id'>position</span>
      <span class='rubyid_ind identifier id'>ind</span> <span class='assign token'>=</span> <span class='rubyid_i identifier id'>i</span>
      <span class='rubyid_break break kw'>break</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_return return kw'>return</span> <span class='rubyid_ind identifier id'>ind</span> <span class='question op'>?</span> <span class='rubyid_ind identifier id'>ind</span> <span class='colon op'>:</span> <span class='integer val'>-1</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="merge_details-instance_method">
  
    #<strong>merge_details</strong>(merge_destination, merge_candidate, selections, params)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'backend/app/lib/merge_helpers.rb', line 82</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_merge_details identifier id'>merge_details</span><span class='lparen token'>(</span><span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='comma token'>,</span> <span class='rubyid_merge_candidate identifier id'>merge_candidate</span><span class='comma token'>,</span> <span class='rubyid_selections identifier id'>selections</span><span class='comma token'>,</span> <span class='rubyid_params identifier id'>params</span><span class='rparen token'>)</span>
  <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='symbol val'>:linked_events</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='rubyid_merge_candidate identifier id'>merge_candidate</span><span class='lbrack token'>[</span><span class='symbol val'>:linked_events</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>

  <span class='rubyid_subrec_add_replacements identifier id'>subrec_add_replacements</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='rubyid_field_replacements identifier id'>field_replacements</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='rubyid_merge_candidate_values identifier id'>merge_candidate_values</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='rubyid_values_from_params identifier id'>values_from_params</span> <span class='assign token'>=</span> <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:merge_request_detail</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_selections identifier id'>selections</span>

  <span class='comment val'># this code breaks selections into arrays like this:</span>
  <span class='comment val'># [&quot;agent_record_identifiers&quot;, 1, &quot;append&quot;, 2] // add entire subrec, record is in position 2</span>
  <span class='comment val'># [&quot;agent_record_controls&quot;, 0, &quot;replace&quot;, 1] // replace entire subrec, record is in position 1</span>
  <span class='comment val'># [&quot;agent_record_controls&quot;, 0, &quot;maintenance_status&quot;, 1] // replace field, record is in position 1</span>
  <span class='comment val'># [&quot;agent_record_controls&quot;, 0, &quot;publication_status&quot;, 0] // replace field, record is in position 0</span>
  <span class='comment val'># [&quot;agent_record_controls&quot;, 0, &quot;maintenance_agency&quot;, 3]</span>
  <span class='comment val'># and then creates data structures for the subrecords to append, replace entirely, and replace by field. record in in position 3</span>
  <span class='rubyid_selections identifier id'>selections</span><span class='dot token'>.</span><span class='rubyid_each_key identifier id'>each_key</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_key identifier id'>key</span><span class='bitor op'>|</span>
    <span class='rubyid_path identifier id'>path</span> <span class='assign token'>=</span> <span class='rubyid_key identifier id'>key</span><span class='dot token'>.</span><span class='rubyid_split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;.&quot;</span><span class='rparen token'>)</span>
    <span class='rubyid_path_fix identifier id'>path_fix</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
    <span class='rubyid_path identifier id'>path</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_part identifier id'>part</span><span class='bitor op'>|</span>
      <span class='rubyid_if if kw'>if</span> <span class='rubyid_part identifier id'>part</span><span class='dot token'>.</span><span class='rubyid_length identifier id'>length</span> <span class='eqq op'>===</span> <span class='integer val'>1</span>
        <span class='rubyid_part identifier id'>part</span> <span class='assign token'>=</span> <span class='rubyid_part identifier id'>part</span><span class='dot token'>.</span><span class='rubyid_to_i identifier id'>to_i</span>
      <span class='rubyid_elsif elsif kw'>elsif</span> <span class='lparen token'>(</span><span class='rubyid_part identifier id'>part</span><span class='dot token'>.</span><span class='rubyid_length identifier id'>length</span> <span class='eqq op'>===</span> <span class='integer val'>2</span><span class='rparen token'>)</span> <span class='rubyid_and and kw'>and</span> <span class='lparen token'>(</span><span class='rubyid_part identifier id'>part</span><span class='dot token'>.</span><span class='rubyid_start_with? fid id'>start_with?</span><span class='lparen token'>(</span><span class='string val'>&#39;1&#39;</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
        <span class='rubyid_part identifier id'>part</span> <span class='assign token'>=</span> <span class='rubyid_part identifier id'>part</span><span class='dot token'>.</span><span class='rubyid_to_i identifier id'>to_i</span>
      <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_path_fix identifier id'>path_fix</span><span class='dot token'>.</span><span class='rubyid_push identifier id'>push</span><span class='lparen token'>(</span><span class='rubyid_part identifier id'>part</span><span class='rparen token'>)</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='rubyid_subrec_name identifier id'>subrec_name</span> <span class='assign token'>=</span> <span class='rubyid_path_fix identifier id'>path_fix</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
    <span class='rubyid_merge_candidate_values identifier id'>merge_candidate_values</span><span class='lbrack token'>[</span><span class='rubyid_subrec_name identifier id'>subrec_name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_values_from_params identifier id'>values_from_params</span><span class='lbrack token'>[</span><span class='rubyid_subrec_name identifier id'>subrec_name</span><span class='rbrack token'>]</span>

    <span class='comment val'># subrec level add/replace</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_path_fix identifier id'>path_fix</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='string val'>&quot;append&quot;</span> <span class='orop op'>||</span> <span class='rubyid_path_fix identifier id'>path_fix</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='string val'>&quot;replace&quot;</span>
      <span class='rubyid_subrec_add_replacements identifier id'>subrec_add_replacements</span><span class='dot token'>.</span><span class='rubyid_push identifier id'>push</span><span class='lparen token'>(</span><span class='rubyid_path_fix identifier id'>path_fix</span><span class='rparen token'>)</span>

    <span class='comment val'># field level replace</span>
    <span class='rubyid_else else kw'>else</span>
      <span class='rubyid_field_replacements identifier id'>field_replacements</span><span class='dot token'>.</span><span class='rubyid_push identifier id'>push</span><span class='lparen token'>(</span><span class='rubyid_path_fix identifier id'>path_fix</span><span class='rparen token'>)</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_merge_details_subrec identifier id'>merge_details_subrec</span><span class='lparen token'>(</span><span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='comma token'>,</span> <span class='rubyid_merge_candidate identifier id'>merge_candidate</span><span class='comma token'>,</span> <span class='rubyid_subrec_add_replacements identifier id'>subrec_add_replacements</span><span class='comma token'>,</span> <span class='rubyid_merge_candidate_values identifier id'>merge_candidate_values</span><span class='rparen token'>)</span>
  <span class='rubyid_merge_details_replace_field identifier id'>merge_details_replace_field</span><span class='lparen token'>(</span><span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='comma token'>,</span> <span class='rubyid_merge_candidate identifier id'>merge_candidate</span><span class='comma token'>,</span> <span class='rubyid_field_replacements identifier id'>field_replacements</span><span class='comma token'>,</span> <span class='rubyid_merge_candidate_values identifier id'>merge_candidate_values</span><span class='rparen token'>)</span>

  <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&#39;title&#39;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&#39;names&#39;</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>&#39;sort_name&#39;</span><span class='rbrack token'>]</span>
  <span class='rubyid_merge_destination identifier id'>merge_destination</span>

<span class='comment val'># This code can be hard to debug when things go wrong, especially since details of problems aren&#39;t bubbled up to the frontend where the user is.</span>
<span class='comment val'># So we&#39;ll make sure to catch problems and dump out any info we know.</span>
<span class='rubyid_rescue rescue kw'>rescue</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_e identifier id'>e</span>
  <span class='rubyid_STDERR constant id'>STDERR</span><span class='dot token'>.</span><span class='rubyid_puts identifier id'>puts</span> <span class='string val'>&quot;EXCEPTION!&quot;</span>
  <span class='rubyid_STDERR constant id'>STDERR</span><span class='dot token'>.</span><span class='rubyid_puts identifier id'>puts</span> <span class='rubyid_e identifier id'>e</span><span class='dot token'>.</span><span class='rubyid_inspect identifier id'>inspect</span>
  <span class='rubyid_STDERR constant id'>STDERR</span><span class='dot token'>.</span><span class='rubyid_puts identifier id'>puts</span> <span class='rubyid_e identifier id'>e</span><span class='dot token'>.</span><span class='rubyid_backtrace identifier id'>backtrace</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="merge_details_replace_field-instance_method">
  
    #<strong>merge_details_replace_field</strong>(merge_destination, merge_candidate, selections, values)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>do field replace operations</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


138
139
140
141
142
143
144
145
146
147
148
149
150</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'backend/app/lib/merge_helpers.rb', line 138</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_merge_details_replace_field identifier id'>merge_details_replace_field</span><span class='lparen token'>(</span><span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='comma token'>,</span> <span class='rubyid_merge_candidate identifier id'>merge_candidate</span><span class='comma token'>,</span> <span class='rubyid_selections identifier id'>selections</span><span class='comma token'>,</span> <span class='rubyid_values identifier id'>values</span><span class='rparen token'>)</span>
  <span class='rubyid_selections identifier id'>selections</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_path_fix identifier id'>path_fix</span><span class='bitor op'>|</span>
    <span class='rubyid_subrec_name identifier id'>subrec_name</span> <span class='assign token'>=</span> <span class='rubyid_path_fix identifier id'>path_fix</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
    <span class='comment val'># this is the index of the order the user arranged the subrecs in the form, not the order of the subrecords in the DB.</span>
    <span class='rubyid_ind identifier id'>ind</span>         <span class='assign token'>=</span> <span class='rubyid_path_fix identifier id'>path_fix</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span>
    <span class='rubyid_field identifier id'>field</span>       <span class='assign token'>=</span> <span class='rubyid_path_fix identifier id'>path_fix</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span>
    <span class='rubyid_position identifier id'>position</span>    <span class='assign token'>=</span> <span class='rubyid_path_fix identifier id'>path_fix</span><span class='lbrack token'>[</span><span class='integer val'>3</span><span class='rbrack token'>]</span>

    <span class='rubyid_subrec_index identifier id'>subrec_index</span> <span class='assign token'>=</span> <span class='rubyid_find_subrec_index_in_merge_candidate identifier id'>find_subrec_index_in_merge_candidate</span><span class='lparen token'>(</span><span class='rubyid_merge_candidate identifier id'>merge_candidate</span><span class='comma token'>,</span> <span class='rubyid_subrec_name identifier id'>subrec_name</span><span class='comma token'>,</span> <span class='rubyid_position identifier id'>position</span><span class='rparen token'>)</span>

    <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='rubyid_subrec_name identifier id'>subrec_name</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='rubyid_ind identifier id'>ind</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='rubyid_field identifier id'>field</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_merge_candidate identifier id'>merge_candidate</span><span class='lbrack token'>[</span><span class='rubyid_subrec_name identifier id'>subrec_name</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='rubyid_subrec_index identifier id'>subrec_index</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='rubyid_field identifier id'>field</span><span class='rbrack token'>]</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="merge_details_subrec-instance_method">
  
    #<strong>merge_details_subrec</strong>(merge_destination, merge_candidate, selections, values)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>do subrec replace operations</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'backend/app/lib/merge_helpers.rb', line 154</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_merge_details_subrec identifier id'>merge_details_subrec</span><span class='lparen token'>(</span><span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='comma token'>,</span> <span class='rubyid_merge_candidate identifier id'>merge_candidate</span><span class='comma token'>,</span> <span class='rubyid_selections identifier id'>selections</span><span class='comma token'>,</span> <span class='rubyid_values identifier id'>values</span><span class='rparen token'>)</span>
  <span class='rubyid_selections identifier id'>selections</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_path_fix identifier id'>path_fix</span><span class='bitor op'>|</span>
    <span class='rubyid_subrec_name identifier id'>subrec_name</span> <span class='assign token'>=</span> <span class='rubyid_path_fix identifier id'>path_fix</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
    <span class='comment val'># this is the index of the order the user arranged the subrecs in the form, not the order of the subrecords in the DB.</span>
    <span class='rubyid_ind identifier id'>ind</span>         <span class='assign token'>=</span> <span class='rubyid_path_fix identifier id'>path_fix</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span>
    <span class='rubyid_mode identifier id'>mode</span>        <span class='assign token'>=</span> <span class='rubyid_path_fix identifier id'>path_fix</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span>
    <span class='rubyid_position identifier id'>position</span>    <span class='assign token'>=</span> <span class='rubyid_path_fix identifier id'>path_fix</span><span class='lbrack token'>[</span><span class='integer val'>3</span><span class='rbrack token'>]</span>

    <span class='rubyid_subrec_index identifier id'>subrec_index</span> <span class='assign token'>=</span> <span class='rubyid_find_subrec_index_in_merge_candidate identifier id'>find_subrec_index_in_merge_candidate</span><span class='lparen token'>(</span><span class='rubyid_merge_candidate identifier id'>merge_candidate</span><span class='comma token'>,</span> <span class='rubyid_subrec_name identifier id'>subrec_name</span><span class='comma token'>,</span> <span class='rubyid_position identifier id'>position</span><span class='rparen token'>)</span>

    <span class='rubyid_replacer identifier id'>replacer</span> <span class='assign token'>=</span> <span class='rubyid_merge_candidate identifier id'>merge_candidate</span><span class='lbrack token'>[</span><span class='rubyid_subrec_name identifier id'>subrec_name</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='rubyid_subrec_index identifier id'>subrec_index</span><span class='rbrack token'>]</span>

    <span class='comment val'># notes are a special case because of the way they store JSON in a db field. So Reordering is not supported, and we can assume the position in the merge request is the position in the merge_candidates notes subrecord JSON.</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_subrec_name identifier id'>subrec_name</span> <span class='eq op'>==</span> <span class='string val'>&quot;notes&quot;</span>
      <span class='rubyid_replacer identifier id'>replacer</span> <span class='assign token'>=</span> <span class='rubyid_merge_candidate identifier id'>merge_candidate</span><span class='lbrack token'>[</span><span class='string val'>&quot;notes&quot;</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='rubyid_ind identifier id'>ind</span><span class='rbrack token'>]</span>
      <span class='rubyid_to_append identifier id'>to_append</span> <span class='assign token'>=</span> <span class='rubyid_process_subrecord_for_merge identifier id'>process_subrecord_for_merge</span><span class='lparen token'>(</span><span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='comma token'>,</span> <span class='rubyid_replacer identifier id'>replacer</span><span class='comma token'>,</span> <span class='rubyid_subrec_name identifier id'>subrec_name</span><span class='comma token'>,</span> <span class='rubyid_mode identifier id'>mode</span><span class='comma token'>,</span> <span class='rubyid_ind identifier id'>ind</span><span class='rparen token'>)</span>

      <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='rubyid_subrec_name identifier id'>subrec_name</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_push identifier id'>push</span><span class='lparen token'>(</span><span class='rubyid_process_subrecord_for_merge identifier id'>process_subrecord_for_merge</span><span class='lparen token'>(</span><span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='comma token'>,</span> <span class='rubyid_replacer identifier id'>replacer</span><span class='comma token'>,</span> <span class='rubyid_subrec_name identifier id'>subrec_name</span><span class='comma token'>,</span> <span class='rubyid_mode identifier id'>mode</span><span class='comma token'>,</span> <span class='rubyid_ind identifier id'>ind</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_mode identifier id'>mode</span> <span class='eq op'>==</span> <span class='string val'>&quot;replace&quot;</span>
      <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='rubyid_subrec_name identifier id'>subrec_name</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='rubyid_ind identifier id'>ind</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_process_subrecord_for_merge identifier id'>process_subrecord_for_merge</span><span class='lparen token'>(</span><span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='comma token'>,</span> <span class='rubyid_replacer identifier id'>replacer</span><span class='comma token'>,</span> <span class='rubyid_subrec_name identifier id'>subrec_name</span><span class='comma token'>,</span> <span class='rubyid_mode identifier id'>mode</span><span class='comma token'>,</span> <span class='rubyid_ind identifier id'>ind</span><span class='rparen token'>)</span>
    <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_mode identifier id'>mode</span> <span class='eq op'>==</span> <span class='string val'>&quot;append&quot;</span>
      <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='rubyid_subrec_name identifier id'>subrec_name</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_push identifier id'>push</span><span class='lparen token'>(</span><span class='rubyid_process_subrecord_for_merge identifier id'>process_subrecord_for_merge</span><span class='lparen token'>(</span><span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='comma token'>,</span> <span class='rubyid_replacer identifier id'>replacer</span><span class='comma token'>,</span> <span class='rubyid_subrec_name identifier id'>subrec_name</span><span class='comma token'>,</span> <span class='rubyid_mode identifier id'>mode</span><span class='comma token'>,</span> <span class='rubyid_ind identifier id'>ind</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="parse_references-instance_method">
  
    #<strong>parse_references</strong>(request)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


2
3
4
5
6
7</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'backend/app/lib/merge_helpers.rb', line 2</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_parse_references identifier id'>parse_references</span><span class='lparen token'>(</span><span class='rubyid_request identifier id'>request</span><span class='rparen token'>)</span>
  <span class='rubyid_merge_destination identifier id'>merge_destination</span> <span class='assign token'>=</span> <span class='rubyid_JSONModel constant id'>JSONModel</span><span class='dot token'>.</span><span class='rubyid_parse_reference identifier id'>parse_reference</span><span class='lparen token'>(</span><span class='rubyid_request identifier id'>request</span><span class='dot token'>.</span><span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&#39;ref&#39;</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='rubyid_merge_candidates identifier id'>merge_candidates</span> <span class='assign token'>=</span> <span class='rubyid_request identifier id'>request</span><span class='dot token'>.</span><span class='rubyid_merge_candidates identifier id'>merge_candidates</span><span class='dot token'>.</span><span class='rubyid_map identifier id'>map</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_merge_candidate identifier id'>merge_candidate</span><span class='bitor op'>|</span> <span class='rubyid_JSONModel constant id'>JSONModel</span><span class='dot token'>.</span><span class='rubyid_parse_reference identifier id'>parse_reference</span><span class='lparen token'>(</span><span class='rubyid_merge_candidate identifier id'>merge_candidate</span><span class='lbrack token'>[</span><span class='string val'>&#39;ref&#39;</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rbrace token'>}</span>

  <span class='lbrack token'>[</span><span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='comma token'>,</span> <span class='rubyid_merge_candidates identifier id'>merge_candidates</span><span class='rbrack token'>]</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="parse_selections-instance_method">
  
    #<strong>parse_selections</strong>(selections, path = [], all_values = {})  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'backend/app/lib/merge_helpers.rb', line 24</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_parse_selections identifier id'>parse_selections</span><span class='lparen token'>(</span><span class='rubyid_selections identifier id'>selections</span><span class='comma token'>,</span> <span class='rubyid_path identifier id'>path</span><span class='assign token'>=</span><span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_all_values identifier id'>all_values</span><span class='assign token'>=</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='rubyid_selections identifier id'>selections</span><span class='dot token'>.</span><span class='rubyid_each_pair identifier id'>each_pair</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_k identifier id'>k</span><span class='comma token'>,</span> <span class='rubyid_v identifier id'>v</span><span class='bitor op'>|</span>
    <span class='rubyid_path identifier id'>path</span> <span class='lshft op'>&lt;&lt;</span> <span class='rubyid_k identifier id'>k</span>

    <span class='rubyid_position identifier id'>position</span> <span class='assign token'>=</span> <span class='rubyid_selections identifier id'>selections</span><span class='lbrack token'>[</span><span class='string val'>&#39;position&#39;</span><span class='rbrack token'>]</span>

    <span class='rubyid_case case kw'>case</span> <span class='rubyid_v identifier id'>v</span>
    <span class='rubyid_when when kw'>when</span> <span class='rubyid_String constant id'>String</span>
      <span class='rubyid_if if kw'>if</span> <span class='rubyid_v identifier id'>v</span> <span class='eqq op'>===</span> <span class='string val'>&quot;REPLACE&quot;</span>
        <span class='rubyid_all_values identifier id'>all_values</span><span class='dot token'>.</span><span class='rubyid_merge! fid id'>merge!</span><span class='lparen token'>(</span><span class='lbrace token'>{</span><span class='dstring node'>&quot;#{path.join(&quot;.&quot;)}.#{position}&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;#{v}&quot;</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
        <span class='rubyid_path identifier id'>path</span><span class='dot token'>.</span><span class='rubyid_pop identifier id'>pop</span>
      <span class='rubyid_else else kw'>else</span>
        <span class='rubyid_path identifier id'>path</span><span class='dot token'>.</span><span class='rubyid_pop identifier id'>pop</span>
        <span class='rubyid_next next kw'>next</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_when when kw'>when</span> <span class='rubyid_Hash constant id'>Hash</span> <span class='rubyid_then then kw'>then</span> <span class='rubyid_parse_selections identifier id'>parse_selections</span><span class='lparen token'>(</span><span class='rubyid_v identifier id'>v</span><span class='comma token'>,</span> <span class='rubyid_path identifier id'>path</span><span class='comma token'>,</span> <span class='rubyid_all_values identifier id'>all_values</span><span class='rparen token'>)</span>
    <span class='rubyid_when when kw'>when</span> <span class='rubyid_Array constant id'>Array</span> <span class='rubyid_then then kw'>then</span> <span class='rubyid_v identifier id'>v</span><span class='dot token'>.</span><span class='rubyid_each_with_index identifier id'>each_with_index</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_v2 identifier id'>v2</span><span class='comma token'>,</span> <span class='rubyid_index identifier id'>index</span><span class='bitor op'>|</span>
        <span class='rubyid_next next kw'>next</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_v2 identifier id'>v2</span><span class='dot token'>.</span><span class='rubyid_is_a? fid id'>is_a?</span> <span class='rubyid_String constant id'>String</span>
        <span class='rubyid_path identifier id'>path</span> <span class='lshft op'>&lt;&lt;</span> <span class='rubyid_index identifier id'>index</span>
        <span class='rubyid_parse_selections identifier id'>parse_selections</span><span class='lparen token'>(</span><span class='rubyid_v2 identifier id'>v2</span><span class='comma token'>,</span> <span class='rubyid_path identifier id'>path</span><span class='comma token'>,</span> <span class='rubyid_all_values identifier id'>all_values</span><span class='rparen token'>)</span>
      <span class='rubyid_end end kw'>end</span>
                    <span class='rubyid_path identifier id'>path</span><span class='dot token'>.</span><span class='rubyid_pop identifier id'>pop</span>
    <span class='rubyid_else else kw'>else</span>
      <span class='rubyid_path identifier id'>path</span><span class='dot token'>.</span><span class='rubyid_pop identifier id'>pop</span>
      <span class='rubyid_next next kw'>next</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_path identifier id'>path</span><span class='dot token'>.</span><span class='rubyid_pop identifier id'>pop</span>

  <span class='rubyid_return return kw'>return</span> <span class='rubyid_all_values identifier id'>all_values</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="preview_sort_name-instance_method">
  
    #<strong>preview_sort_name</strong>(merge_destination)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>NOTE: this code is a duplicate of the auto_generate code for creating sort name
in the name_person, name_family, name_software, name_corporate_entity models
Consider refactoring when continued work done on the agents model enhancements</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'backend/app/lib/merge_helpers.rb', line 232</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_preview_sort_name identifier id'>preview_sort_name</span><span class='lparen token'>(</span><span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='rparen token'>)</span>
  <span class='rubyid_result identifier id'>result</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>

  <span class='rubyid_case case kw'>case</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&#39;jsonmodel_type&#39;</span><span class='rbrack token'>]</span>
  <span class='rubyid_when when kw'>when</span> <span class='string val'>&#39;name_person&#39;</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&quot;name_order&quot;</span><span class='rbrack token'>]</span> <span class='eqq op'>===</span> <span class='string val'>&quot;inverted&quot;</span>
      <span class='rubyid_result identifier id'>result</span> <span class='lshft op'>&lt;&lt;</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&quot;primary_name&quot;</span><span class='rbrack token'>]</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&quot;primary_name&quot;</span><span class='rbrack token'>]</span>
      <span class='rubyid_result identifier id'>result</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;, #{merge_destination[&quot;rest_of_name&quot;]}&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&quot;rest_of_name&quot;</span><span class='rbrack token'>]</span>
    <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&quot;name_order&quot;</span><span class='rbrack token'>]</span> <span class='eqq op'>===</span> <span class='string val'>&quot;direct&quot;</span>
      <span class='rubyid_result identifier id'>result</span> <span class='lshft op'>&lt;&lt;</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&quot;rest_of_name&quot;</span><span class='rbrack token'>]</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&quot;rest_of_name&quot;</span><span class='rbrack token'>]</span>
      <span class='rubyid_result identifier id'>result</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot; #{merge_destination[&quot;primary_name&quot;]}&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&quot;primary_name&quot;</span><span class='rbrack token'>]</span>
    <span class='rubyid_else else kw'>else</span>
      <span class='rubyid_result identifier id'>result</span> <span class='lshft op'>&lt;&lt;</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&quot;primary_name&quot;</span><span class='rbrack token'>]</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&quot;primary_name&quot;</span><span class='rbrack token'>]</span>
    <span class='rubyid_end end kw'>end</span>

    <span class='rubyid_result identifier id'>result</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;, #{merge_destination[&quot;prefix&quot;]}&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&quot;prefix&quot;</span><span class='rbrack token'>]</span>
    <span class='rubyid_result identifier id'>result</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;, #{merge_destination[&quot;suffix&quot;]}&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&quot;suffix&quot;</span><span class='rbrack token'>]</span>
    <span class='rubyid_result identifier id'>result</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;, #{merge_destination[&quot;title&quot;]}&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&quot;title&quot;</span><span class='rbrack token'>]</span>
    <span class='rubyid_result identifier id'>result</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;, #{merge_destination[&quot;number&quot;]}&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&quot;number&quot;</span><span class='rbrack token'>]</span>
    <span class='rubyid_result identifier id'>result</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot; (#{merge_destination[&quot;fuller_form&quot;]})&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&quot;fuller_form&quot;</span><span class='rbrack token'>]</span>
    <span class='rubyid_result identifier id'>result</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;, #{merge_destination[&quot;dates&quot;]}&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&quot;dates&quot;</span><span class='rbrack token'>]</span>
  <span class='rubyid_when when kw'>when</span> <span class='string val'>&#39;name_corporate_entity&#39;</span>
    <span class='rubyid_result identifier id'>result</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{merge_destination[&quot;primary_name&quot;]}&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&quot;primary_name&quot;</span><span class='rbrack token'>]</span>
    <span class='rubyid_result identifier id'>result</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;. #{merge_destination[&quot;subordinate_name_1&quot;]}&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&quot;subordinate_name_1&quot;</span><span class='rbrack token'>]</span>
    <span class='rubyid_result identifier id'>result</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;. #{merge_destination[&quot;subordinate_name_2&quot;]}&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&quot;subordinate_name_2&quot;</span><span class='rbrack token'>]</span>

    <span class='rubyid_grouped identifier id'>grouped</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&quot;number&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&quot;dates&quot;</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_reject identifier id'>reject</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_v identifier id'>v</span><span class='bitor op'>|</span> <span class='rubyid_v identifier id'>v</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span><span class='rbrace token'>}</span>
    <span class='rubyid_result identifier id'>result</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot; (#{grouped.join(&quot; : &quot;)})&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_not not kw'>not</span> <span class='rubyid_grouped identifier id'>grouped</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>
  <span class='rubyid_when when kw'>when</span> <span class='string val'>&#39;name_family&#39;</span>
    <span class='rubyid_result identifier id'>result</span> <span class='lshft op'>&lt;&lt;</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&quot;family_name&quot;</span><span class='rbrack token'>]</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&quot;family_name&quot;</span><span class='rbrack token'>]</span>
    <span class='rubyid_result identifier id'>result</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;, #{merge_destination[&quot;prefix&quot;]}&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&quot;prefix&quot;</span><span class='rbrack token'>]</span>
    <span class='rubyid_result identifier id'>result</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;, #{merge_destination[&quot;dates&quot;]}&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&quot;dates&quot;</span><span class='rbrack token'>]</span>
  <span class='rubyid_when when kw'>when</span> <span class='string val'>&#39;name_software&#39;</span>
    <span class='rubyid_result identifier id'>result</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{merge_destination[&quot;manufacturer&quot;]} &quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&quot;manufacturer&quot;</span><span class='rbrack token'>]</span>
    <span class='rubyid_result identifier id'>result</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{merge_destination[&quot;software_name&quot;]}&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&quot;software_name&quot;</span><span class='rbrack token'>]</span>
    <span class='rubyid_result identifier id'>result</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot; #{merge_destination[&quot;version&quot;]}&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&quot;version&quot;</span><span class='rbrack token'>]</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_result identifier id'>result</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot; (#{merge_destination[&quot;qualifier&quot;]})&quot;</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&quot;qualifier&quot;</span><span class='rbrack token'>]</span>

  <span class='rubyid_result identifier id'>result</span><span class='dot token'>.</span><span class='rubyid_lstrip! fid id'>lstrip!</span>

  <span class='rubyid_if if kw'>if</span> <span class='rubyid_result identifier id'>result</span><span class='dot token'>.</span><span class='rubyid_length identifier id'>length</span> <span class='gt op'>&gt;</span> <span class='integer val'>255</span>
    <span class='rubyid_return return kw'>return</span> <span class='rubyid_result identifier id'>result</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='dot2 op'>..</span><span class='integer val'>254</span><span class='rbrack token'>]</span>
  <span class='rubyid_else else kw'>else</span>
    <span class='rubyid_return return kw'>return</span> <span class='rubyid_result identifier id'>result</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="process_subrecord_for_merge-instance_method">
  
    #<strong>process_subrecord_for_merge</strong>(merge_destination, subrecord, jsonmodel_type, mode, ind)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>before we can merge a subrecord, we need to update the IDs, tweak things to prevent validation issues, etc</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'backend/app/lib/merge_helpers.rb', line 196</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_process_subrecord_for_merge identifier id'>process_subrecord_for_merge</span><span class='lparen token'>(</span><span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='comma token'>,</span> <span class='rubyid_subrecord identifier id'>subrecord</span><span class='comma token'>,</span> <span class='rubyid_jsonmodel_type identifier id'>jsonmodel_type</span><span class='comma token'>,</span> <span class='rubyid_mode identifier id'>mode</span><span class='comma token'>,</span> <span class='rubyid_ind identifier id'>ind</span><span class='rparen token'>)</span>
  <span class='rubyid_merge_destination_id identifier id'>merge_destination_id</span> <span class='assign token'>=</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&#39;id&#39;</span><span class='rbrack token'>]</span>

  <span class='rubyid_if if kw'>if</span> <span class='rubyid_jsonmodel_type identifier id'>jsonmodel_type</span> <span class='eq op'>==</span> <span class='string val'>&#39;names&#39;</span>
    <span class='comment val'># an agent name can only have one authorized or display name.</span>
    <span class='comment val'># make sure the name being merged in doesn&#39;t conflict with this</span>

    <span class='comment val'># if appending, always disable fields that validate across a set. If replacing, always keep values from merge_destination</span>
    <span class='rubyid_if if kw'>if</span> <span class='rubyid_mode identifier id'>mode</span> <span class='eq op'>==</span> <span class='string val'>&quot;append&quot;</span>
      <span class='rubyid_subrecord identifier id'>subrecord</span><span class='lbrack token'>[</span><span class='string val'>&#39;authorized&#39;</span><span class='rbrack token'>]</span>      <span class='assign token'>=</span> <span class='rubyid_false false kw'>false</span>
      <span class='rubyid_subrecord identifier id'>subrecord</span><span class='lbrack token'>[</span><span class='string val'>&#39;is_display_name&#39;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_false false kw'>false</span>
    <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_mode identifier id'>mode</span> <span class='eq op'>==</span> <span class='string val'>&quot;replace&quot;</span>
      <span class='rubyid_subrecord identifier id'>subrecord</span><span class='lbrack token'>[</span><span class='string val'>&#39;authorized&#39;</span><span class='rbrack token'>]</span>      <span class='assign token'>=</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&#39;names&#39;</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='rubyid_ind identifier id'>ind</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>&#39;authorized&#39;</span><span class='rbrack token'>]</span>
      <span class='rubyid_subrecord identifier id'>subrecord</span><span class='lbrack token'>[</span><span class='string val'>&#39;is_display_name&#39;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&#39;names&#39;</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='rubyid_ind identifier id'>ind</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>&#39;is_display_name&#39;</span><span class='rbrack token'>]</span>
    <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_jsonmodel_type identifier id'>jsonmodel_type</span> <span class='eq op'>==</span> <span class='string val'>&#39;agent_record_identifiers&#39;</span>
    <span class='comment val'># same with agent_record_identifiers being marked as primary, we can only have one</span>

    <span class='rubyid_if if kw'>if</span> <span class='rubyid_mode identifier id'>mode</span> <span class='eq op'>==</span> <span class='string val'>&quot;append&quot;</span>
      <span class='rubyid_subrecord identifier id'>subrecord</span><span class='lbrack token'>[</span><span class='string val'>&#39;primary_identifier&#39;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_false false kw'>false</span>

    <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_mode identifier id'>mode</span> <span class='eq op'>==</span> <span class='string val'>&quot;replace&quot;</span>
      <span class='rubyid_subrecord identifier id'>subrecord</span><span class='lbrack token'>[</span><span class='string val'>&#39;primary_identifier&#39;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_merge_destination identifier id'>merge_destination</span><span class='lbrack token'>[</span><span class='string val'>&#39;agent_record_identifiers&#39;</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='rubyid_ind identifier id'>ind</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>&#39;primary_identifier&#39;</span><span class='rbrack token'>]</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_set_agent_id identifier id'>set_agent_id</span><span class='lparen token'>(</span><span class='rubyid_merge_destination_id identifier id'>merge_destination_id</span><span class='comma token'>,</span> <span class='rubyid_subrecord identifier id'>subrecord</span><span class='rparen token'>)</span>

  <span class='rubyid_return return kw'>return</span> <span class='rubyid_subrecord identifier id'>subrecord</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_agent_id-instance_method">
  
    #<strong>set_agent_id</strong>(merge_destination_id, subrecord)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>when merging, set the agent id foreign key (e.g, agent_person_id, agent_family_id…) from the merge_candidate to the merge_destination</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'backend/app/lib/merge_helpers.rb', line 57</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_set_agent_id identifier id'>set_agent_id</span><span class='lparen token'>(</span><span class='rubyid_merge_destination_id identifier id'>merge_destination_id</span><span class='comma token'>,</span> <span class='rubyid_subrecord identifier id'>subrecord</span><span class='rparen token'>)</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_subrecord identifier id'>subrecord</span><span class='lbrack token'>[</span><span class='string val'>&#39;agent_person_id&#39;</span><span class='rbrack token'>]</span>
    <span class='rubyid_subrecord identifier id'>subrecord</span><span class='lbrack token'>[</span><span class='string val'>&#39;agent_person_id&#39;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_merge_destination_id identifier id'>merge_destination_id</span>

  <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_subrecord identifier id'>subrecord</span><span class='lbrack token'>[</span><span class='string val'>&#39;agent_family_id&#39;</span><span class='rbrack token'>]</span>
    <span class='rubyid_subrecord identifier id'>subrecord</span><span class='lbrack token'>[</span><span class='string val'>&#39;agent_family_id&#39;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_merge_destination_id identifier id'>merge_destination_id</span>

  <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_subrecord identifier id'>subrecord</span><span class='lbrack token'>[</span><span class='string val'>&#39;agent_corporate_entity_id&#39;</span><span class='rbrack token'>]</span>
    <span class='rubyid_subrecord identifier id'>subrecord</span><span class='lbrack token'>[</span><span class='string val'>&#39;agent_corporate_entity_id&#39;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_merge_destination_id identifier id'>merge_destination_id</span>

  <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_subrecord identifier id'>subrecord</span><span class='lbrack token'>[</span><span class='string val'>&#39;agent_software_id&#39;</span><span class='rbrack token'>]</span>
    <span class='rubyid_subrecord identifier id'>subrecord</span><span class='lbrack token'>[</span><span class='string val'>&#39;agent_software_id&#39;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_merge_destination_id identifier id'>merge_destination_id</span>

  <span class='comment val'># this section updates related_agents ids</span>
  <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_subrecord identifier id'>subrecord</span><span class='lbrack token'>[</span><span class='string val'>&#39;agent_person_id_0&#39;</span><span class='rbrack token'>]</span>
    <span class='rubyid_subrecord identifier id'>subrecord</span><span class='lbrack token'>[</span><span class='string val'>&#39;agent_person_id_0&#39;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_merge_destination_id identifier id'>merge_destination_id</span>

  <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_subrecord identifier id'>subrecord</span><span class='lbrack token'>[</span><span class='string val'>&#39;agent_family_id_0&#39;</span><span class='rbrack token'>]</span>
    <span class='rubyid_subrecord identifier id'>subrecord</span><span class='lbrack token'>[</span><span class='string val'>&#39;agent_family_id_0&#39;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_merge_destination_id identifier id'>merge_destination_id</span>

  <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_subrecord identifier id'>subrecord</span><span class='lbrack token'>[</span><span class='string val'>&#39;agent_corporate_entity_id_0&#39;</span><span class='rbrack token'>]</span>
    <span class='rubyid_subrecord identifier id'>subrecord</span><span class='lbrack token'>[</span><span class='string val'>&#39;agent_corporate_entity_id_0&#39;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_merge_destination_id identifier id'>merge_destination_id</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  ArchivesSpace Version release-v4.0.x Documentation Generated on Wed Jun 25 21:11:13 2025 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.36.
</div>

    </div>
  </body>
</html>