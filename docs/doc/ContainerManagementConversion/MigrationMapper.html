<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: ContainerManagementConversion::MigrationMapper
  
    &mdash; Documentation by YARD 0.9.0
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "ContainerManagementConversion::MigrationMapper";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (M)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../ContainerManagementConversion.html" title="ContainerManagementConversion (class)">ContainerManagementConversion</a></span></span>
     &raquo; 
    <span class="title">MigrationMapper</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <iframe id="search_frame" src="../class_list.html"></iframe>

      <div id="content"><h1>Class: ContainerManagementConversion::MigrationMapper
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'><a href="../AspaceJsonToManagedContainerMapper.html" title="AspaceJsonToManagedContainerMapper (class)">AspaceJsonToManagedContainerMapper</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next"><span class='object_link'><a href="../AspaceJsonToManagedContainerMapper.html" title="AspaceJsonToManagedContainerMapper (class)">AspaceJsonToManagedContainerMapper</a></span></li>
          
            <li class="next">ContainerManagementConversion::MigrationMapper</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>backend/app/lib/container_management_conversion.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>An extension of the standard mapper which gets handed hashes of all top
containers used in the current resource and series.  Uses those to avoid
expensive SQL queries to search back up the tree.</p>


  </div>
</div>
<div class="tags">
  

</div>


  <h2>Constant Summary</h2>
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="../JSONModel.html" title="JSONModel (module)">JSONModel</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../JSONModel.html#REFERENCE_KEY_REGEX-constant" title="JSONModel::REFERENCE_KEY_REGEX (constant)">JSONModel::REFERENCE_KEY_REGEX</a></span></p>





  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_or_create_top_container-instance_method" title="#get_or_create_top_container (instance method)">#<strong>get_or_create_top_container</strong>(instance)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(json, new_record, resource_top_containers)  &#x21d2; MigrationMapper </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>A new instance of MigrationMapper.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#try_matching_indicator_within_collection-instance_method" title="#try_matching_indicator_within_collection (instance method)">#<strong>try_matching_indicator_within_collection</strong>(container)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>this is used for searching AOs.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="../AspaceJsonToManagedContainerMapper.html" title="AspaceJsonToManagedContainerMapper (class)">AspaceJsonToManagedContainerMapper</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../AspaceJsonToManagedContainerMapper.html#call-instance_method" title="AspaceJsonToManagedContainerMapper#call (method)">#call</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../JSONModel.html" title="JSONModel (module)">JSONModel</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../JSONModel.html#JSONModel-class_method" title="JSONModel.JSONModel (method)">JSONModel</a></span>, <span class='object_link'><a href="../JSONModel.html#JSONModel-instance_method" title="JSONModel#JSONModel (method)">#JSONModel</a></span>, <span class='object_link'><a href="../JSONModel.html#add_error_handler-class_method" title="JSONModel.add_error_handler (method)">add_error_handler</a></span>, <span class='object_link'><a href="../JSONModel.html#all-class_method" title="JSONModel.all (method)">all</a></span>, <span class='object_link'><a href="../JSONModel.html#allow_unmapped_enum_value-class_method" title="JSONModel.allow_unmapped_enum_value (method)">allow_unmapped_enum_value</a></span>, <span class='object_link'><a href="../JSONModel.html#backend_url-class_method" title="JSONModel.backend_url (method)">backend_url</a></span>, <span class='object_link'><a href="../JSONModel.html#client_mode%3F-class_method" title="JSONModel.client_mode? (method)">client_mode?</a></span>, <span class='object_link'><a href="../JSONModel.html#custom_validations-class_method" title="JSONModel.custom_validations (method)">custom_validations</a></span>, <span class='object_link'><a href="../JSONModel.html#destroy_model-class_method" title="JSONModel.destroy_model (method)">destroy_model</a></span>, <span class='object_link'><a href="../JSONModel.html#enum_default_value-class_method" title="JSONModel.enum_default_value (method)">enum_default_value</a></span>, <span class='object_link'><a href="../JSONModel.html#enum_values-class_method" title="JSONModel.enum_values (method)">enum_values</a></span>, <span class='object_link'><a href="../JSONModel.html#handle_error-class_method" title="JSONModel.handle_error (method)">handle_error</a></span>, <span class='object_link'><a href="../JSONModel.html#init-class_method" title="JSONModel.init (method)">init</a></span>, <span class='object_link'><a href="../JSONModel.html#load_schema-class_method" title="JSONModel.load_schema (method)">load_schema</a></span>, <span class='object_link'><a href="../JSONModel.html#models-instance_method" title="JSONModel#models (method)">#models</a></span>, <span class='object_link'><a href="../JSONModel.html#models-class_method" title="JSONModel.models (method)">models</a></span>, <span class='object_link'><a href="../JSONModel.html#parse_jsonmodel_ref-class_method" title="JSONModel.parse_jsonmodel_ref (method)">parse_jsonmodel_ref</a></span>, <span class='object_link'><a href="../JSONModel.html#parse_reference-class_method" title="JSONModel.parse_reference (method)">parse_reference</a></span>, <span class='object_link'><a href="../JSONModel.html#repository-class_method" title="JSONModel.repository (method)">repository</a></span>, <span class='object_link'><a href="../JSONModel.html#repository_for-class_method" title="JSONModel.repository_for (method)">repository_for</a></span>, <span class='object_link'><a href="../JSONModel.html#schema_src-class_method" title="JSONModel.schema_src (method)">schema_src</a></span>, <span class='object_link'><a href="../JSONModel.html#set_repository-class_method" title="JSONModel.set_repository (method)">set_repository</a></span>, <span class='object_link'><a href="../JSONModel.html#strict_mode-class_method" title="JSONModel.strict_mode (method)">strict_mode</a></span>, <span class='object_link'><a href="../JSONModel.html#strict_mode%3F-class_method" title="JSONModel.strict_mode? (method)">strict_mode?</a></span>, <span class='object_link'><a href="../JSONModel.html#with_repository-class_method" title="JSONModel.with_repository (method)">with_repository</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(json, new_record, resource_top_containers)  &#x21d2; <tt><span class='object_link'><a href="" title="ContainerManagementConversion::MigrationMapper (class)">MigrationMapper</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns a new instance of MigrationMapper</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


174
175
176
177</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'backend/app/lib/container_management_conversion.rb', line 174</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='rubyid_json identifier id'>json</span><span class='comma token'>,</span> <span class='rubyid_new_record identifier id'>new_record</span><span class='comma token'>,</span> <span class='rubyid_resource_top_containers identifier id'>resource_top_containers</span><span class='rparen token'>)</span>
  <span class='rubyid_super super kw'>super</span><span class='lparen token'>(</span><span class='rubyid_json identifier id'>json</span><span class='comma token'>,</span> <span class='rubyid_new_record identifier id'>new_record</span><span class='rparen token'>)</span>
  <span class='rubyid_@resource_top_containers ivar id'>@resource_top_containers</span> <span class='assign token'>=</span> <span class='rubyid_resource_top_containers identifier id'>resource_top_containers</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="get_or_create_top_container-instance_method">
  
    #<strong>get_or_create_top_container</strong>(instance)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'backend/app/lib/container_management_conversion.rb', line 190</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_get_or_create_top_container identifier id'>get_or_create_top_container</span><span class='lparen token'>(</span><span class='rubyid_instance identifier id'>instance</span><span class='rparen token'>)</span>
  <span class='rubyid_extent identifier id'>extent</span> <span class='assign token'>=</span> <span class='rubyid_create_extents_from_container_extents identifier id'>create_extents_from_container_extents</span><span class='lparen token'>(</span><span class='rubyid_instance identifier id'>instance</span><span class='rparen token'>)</span>
  <span class='rubyid_fields identifier id'>fields</span> <span class='assign token'>=</span> <span class='rubyid_@json ivar id'>@json</span><span class='dot token'>.</span><span class='rubyid_instance_variable_get identifier id'>instance_variable_get</span><span class='lparen token'>(</span><span class='string val'>&quot;@fields&quot;</span><span class='dot token'>.</span><span class='rubyid_intern identifier id'>intern</span><span class='rparen token'>)</span> <span class='comment val'>#yuck </span>
  <span class='rubyid_uri identifier id'>uri</span> <span class='assign token'>=</span> <span class='rubyid_fields identifier id'>fields</span><span class='lbrack token'>[</span><span class='string val'>&quot;uri&quot;</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='rubyid_nil nil kw'>nil</span> 

  <span class='rubyid_if if kw'>if</span> <span class='rubyid_extent identifier id'>extent</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_uri identifier id'>uri</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_uri identifier id'>uri</span><span class='dot token'>.</span><span class='rubyid_length identifier id'>length</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span> 
    <span class='rubyid_opts identifier id'>opts</span> <span class='assign token'>=</span> <span class='rubyid_case case kw'>case</span> <span class='rubyid_@json ivar id'>@json</span>
          <span class='rubyid_when when kw'>when</span> <span class='rubyid_JSONModel constant id'>JSONModel</span><span class='lparen token'>(</span><span class='symbol val'>:accession</span><span class='rparen token'>)</span>
            <span class='lbrace token'>{</span> <span class='symbol val'>:accession_id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_@json ivar id'>@json</span><span class='dot token'>.</span><span class='rubyid_class identifier id'>class</span><span class='dot token'>.</span><span class='rubyid_id_for identifier id'>id_for</span><span class='lparen token'>(</span><span class='rubyid_uri identifier id'>uri</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
          <span class='rubyid_when when kw'>when</span> <span class='rubyid_JSONModel constant id'>JSONModel</span><span class='lparen token'>(</span><span class='symbol val'>:resource</span><span class='rparen token'>)</span>
            <span class='lbrace token'>{</span> <span class='symbol val'>:resource_id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='rubyid_@json ivar id'>@json</span><span class='dot token'>.</span><span class='rubyid_class identifier id'>class</span><span class='dot token'>.</span><span class='rubyid_id_for identifier id'>id_for</span><span class='lparen token'>(</span><span class='rubyid_uri identifier id'>uri</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
          <span class='rubyid_when when kw'>when</span> <span class='rubyid_JSONModel constant id'>JSONModel</span><span class='lparen token'>(</span><span class='symbol val'>:archival_object</span><span class='rparen token'>)</span>
            <span class='lbrace token'>{</span> <span class='symbol val'>:archival_object_id</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_@json ivar id'>@json</span><span class='dot token'>.</span><span class='rubyid_class identifier id'>class</span><span class='dot token'>.</span><span class='rubyid_id_for identifier id'>id_for</span><span class='lparen token'>(</span><span class='rubyid_uri identifier id'>uri</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
          <span class='rubyid_end end kw'>end</span>

    <span class='rubyid_Log constant id'>Log</span><span class='dot token'>.</span><span class='rubyid_info identifier id'>info</span><span class='lparen token'>(</span><span class='dstring node'>&quot;Creating a new extent record with values #{extent.inspect} #{opts.inspect}&quot;</span><span class='rparen token'>)</span>
    <span class='rubyid_Extent constant id'>Extent</span><span class='dot token'>.</span><span class='rubyid_create_from_json identifier id'>create_from_json</span><span class='lparen token'>(</span><span class='rubyid_extent identifier id'>extent</span><span class='comma token'>,</span> <span class='rubyid_opts identifier id'>opts</span><span class='rparen token'>)</span>
  <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_super super kw'>super</span><span class='lparen token'>(</span><span class='rubyid_instance identifier id'>instance</span><span class='rparen token'>)</span> 

<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="try_matching_indicator_within_collection-instance_method">
  
    #<strong>try_matching_indicator_within_collection</strong>(container)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>this is used for searching AOs. Important to note this duck patch is
used only in the container mgmn conversion&#8230;</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


182
183
184
185
186
187
188</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'backend/app/lib/container_management_conversion.rb', line 182</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_try_matching_indicator_within_collection identifier id'>try_matching_indicator_within_collection</span><span class='lparen token'>(</span><span class='rubyid_container identifier id'>container</span><span class='rparen token'>)</span>
  
  <span class='rubyid_indicator identifier id'>indicator</span> <span class='assign token'>=</span> <span class='rubyid_container identifier id'>container</span><span class='lbrack token'>[</span><span class='string val'>'indicator_1'</span><span class='rbrack token'>]</span>
  <span class='rubyid_type identifier id'>type</span> <span class='assign token'>=</span> <span class='rubyid_container identifier id'>container</span><span class='lbrack token'>[</span><span class='string val'>&quot;type_1&quot;</span><span class='rbrack token'>]</span>
  
  <span class='rubyid_@resource_top_containers ivar id'>@resource_top_containers</span><span class='dot token'>.</span><span class='rubyid_values identifier id'>values</span><span class='dot token'>.</span><span class='rubyid_find identifier id'>find</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_top_container identifier id'>top_container</span><span class='bitor op'>|</span> <span class='rubyid_top_container identifier id'>top_container</span><span class='dot token'>.</span><span class='rubyid_indicator identifier id'>indicator</span> <span class='eq op'>==</span> <span class='rubyid_indicator identifier id'>indicator</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_top_container identifier id'>top_container</span><span class='dot token'>.</span><span class='rubyid_type identifier id'>type</span> <span class='eq op'>==</span> <span class='rubyid_type identifier id'>type</span><span class='rbrace token'>}</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  ArchivesSpace Version v1.5.3 Documentation Generated on Wed Feb 15 10:10:16 2017 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.0 (ruby-1.9.3).
</div>
    </div>
  </body>
</html>