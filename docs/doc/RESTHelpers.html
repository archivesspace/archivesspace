<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: RESTHelpers
  
    &mdash; Documentation by YARD 0.9.20
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "RESTHelpers";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="alpha_index.html">Index (R)</a> &raquo;
    
    
    <span class="title">RESTHelpers</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: RESTHelpers
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd><span class='object_link'><a href="JSONModel.html" title="JSONModel (module)">JSONModel</a></span></dd>
  </dl>
  
  

  
  <dl>
    <dt>Included in:</dt>
    <dd><span class='object_link'><a href="ArchivesSpaceService.html" title="ArchivesSpaceService (class)">ArchivesSpaceService</a></span></dd>
  </dl>
  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>backend/app/lib/rest.rb</dd>
  </dl>
  
</div>

<h2>Defined Under Namespace</h2>
<p class="children">
  
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="RESTHelpers/ResponseHelpers.html" title="RESTHelpers::ResponseHelpers (module)">ResponseHelpers</a></span>
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="RESTHelpers/BooleanParam.html" title="RESTHelpers::BooleanParam (class)">BooleanParam</a></span>, <span class='object_link'><a href="RESTHelpers/Endpoint.html" title="RESTHelpers::Endpoint (class)">Endpoint</a></span>, <span class='object_link'><a href="RESTHelpers/IdSet.html" title="RESTHelpers::IdSet (class)">IdSet</a></span>, <span class='object_link'><a href="RESTHelpers/NonNegativeInteger.html" title="RESTHelpers::NonNegativeInteger (class)">NonNegativeInteger</a></span>, <span class='object_link'><a href="RESTHelpers/PageSize.html" title="RESTHelpers::PageSize (class)">PageSize</a></span>, <span class='object_link'><a href="RESTHelpers/UploadFile.html" title="RESTHelpers::UploadFile (class)">UploadFile</a></span>
    
  
    
  
</p>



  <h2>Constant Summary</h2>
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="JSONModel.html" title="JSONModel (module)">JSONModel</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="JSONModel.html#REFERENCE_KEY_REGEX-constant" title="JSONModel::REFERENCE_KEY_REGEX (constant)">JSONModel::REFERENCE_KEY_REGEX</a></span></p>





  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#included-class_method" title="included (class method)">.<strong>included</strong>(base)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="JSONModel.html" title="JSONModel (module)">JSONModel</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="JSONModel.html#JSONModel-class_method" title="JSONModel.JSONModel (method)">JSONModel</a></span>, <span class='object_link'><a href="JSONModel.html#JSONModel-instance_method" title="JSONModel#JSONModel (method)">#JSONModel</a></span>, <span class='object_link'><a href="JSONModel.html#add_error_handler-class_method" title="JSONModel.add_error_handler (method)">add_error_handler</a></span>, <span class='object_link'><a href="JSONModel.html#all-class_method" title="JSONModel.all (method)">all</a></span>, <span class='object_link'><a href="JSONModel.html#allow_unmapped_enum_value-class_method" title="JSONModel.allow_unmapped_enum_value (method)">allow_unmapped_enum_value</a></span>, <span class='object_link'><a href="JSONModel.html#backend_url-class_method" title="JSONModel.backend_url (method)">backend_url</a></span>, <span class='object_link'><a href="JSONModel.html#check_valid_refs-class_method" title="JSONModel.check_valid_refs (method)">check_valid_refs</a></span>, <span class='object_link'><a href="JSONModel.html#client_mode%3F-class_method" title="JSONModel.client_mode? (method)">client_mode?</a></span>, <span class='object_link'><a href="JSONModel.html#custom_validations-class_method" title="JSONModel.custom_validations (method)">custom_validations</a></span>, <span class='object_link'><a href="JSONModel.html#destroy_model-class_method" title="JSONModel.destroy_model (method)">destroy_model</a></span>, <span class='object_link'><a href="JSONModel.html#enum_default_value-class_method" title="JSONModel.enum_default_value (method)">enum_default_value</a></span>, <span class='object_link'><a href="JSONModel.html#enum_values-class_method" title="JSONModel.enum_values (method)">enum_values</a></span>, <span class='object_link'><a href="JSONModel.html#handle_error-class_method" title="JSONModel.handle_error (method)">handle_error</a></span>, <span class='object_link'><a href="JSONModel.html#init-class_method" title="JSONModel.init (method)">init</a></span>, <span class='object_link'><a href="JSONModel.html#load_schema-class_method" title="JSONModel.load_schema (method)">load_schema</a></span>, <span class='object_link'><a href="JSONModel.html#models-instance_method" title="JSONModel#models (method)">#models</a></span>, <span class='object_link'><a href="JSONModel.html#models-class_method" title="JSONModel.models (method)">models</a></span>, <span class='object_link'><a href="JSONModel.html#parse_jsonmodel_ref-class_method" title="JSONModel.parse_jsonmodel_ref (method)">parse_jsonmodel_ref</a></span>, <span class='object_link'><a href="JSONModel.html#parse_reference-class_method" title="JSONModel.parse_reference (method)">parse_reference</a></span>, <span class='object_link'><a href="JSONModel.html#repository-class_method" title="JSONModel.repository (method)">repository</a></span>, <span class='object_link'><a href="JSONModel.html#repository_for-class_method" title="JSONModel.repository_for (method)">repository_for</a></span>, <span class='object_link'><a href="JSONModel.html#schema_src-class_method" title="JSONModel.schema_src (method)">schema_src</a></span>, <span class='object_link'><a href="JSONModel.html#set_publish_flags!-class_method" title="JSONModel.set_publish_flags! (method)">set_publish_flags!</a></span>, <span class='object_link'><a href="JSONModel.html#set_repository-class_method" title="JSONModel.set_repository (method)">set_repository</a></span>, <span class='object_link'><a href="JSONModel.html#strict_mode-class_method" title="JSONModel.strict_mode (method)">strict_mode</a></span>, <span class='object_link'><a href="JSONModel.html#strict_mode%3F-class_method" title="JSONModel.strict_mode? (method)">strict_mode?</a></span>, <span class='object_link'><a href="JSONModel.html#validate_schema-class_method" title="JSONModel.validate_schema (method)">validate_schema</a></span>, <span class='object_link'><a href="JSONModel.html#with_repository-class_method" title="JSONModel.with_repository (method)">with_repository</a></span></p>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="included-class_method">
  
    .<strong>included</strong>(base)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'backend/app/lib/rest.rb', line 436</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_included identifier id'>included</span><span class='lparen token'>(</span><span class='rubyid_base identifier id'>base</span><span class='rparen token'>)</span>

  <span class='rubyid_base identifier id'>base</span><span class='dot token'>.</span><span class='rubyid_extend identifier id'>extend</span><span class='lparen token'>(</span><span class='rubyid_JSONModel constant id'>JSONModel</span><span class='rparen token'>)</span>

  <span class='rubyid_base identifier id'>base</span><span class='dot token'>.</span><span class='rubyid_helpers identifier id'>helpers</span> <span class='rubyid_do do kw'>do</span>

    <span class='rubyid_def def kw'>def</span> <span class='rubyid_coerce_type identifier id'>coerce_type</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='comma token'>,</span> <span class='rubyid_type identifier id'>type</span><span class='rparen token'>)</span>
      <span class='rubyid_if if kw'>if</span> <span class='rubyid_type identifier id'>type</span> <span class='eq op'>==</span> <span class='rubyid_Integer constant id'>Integer</span>
        <span class='rubyid_Integer constant id'>Integer</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span>
      <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_type identifier id'>type</span> <span class='eq op'>==</span> <span class='rubyid_DateTime constant id'>DateTime</span>
        <span class='rubyid_DateTime constant id'>DateTime</span><span class='dot token'>.</span><span class='rubyid_parse identifier id'>parse</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span>
      <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_type identifier id'>type</span> <span class='eq op'>==</span> <span class='rubyid_Date constant id'>Date</span>
        <span class='rubyid_Date constant id'>Date</span><span class='dot token'>.</span><span class='rubyid_parse identifier id'>parse</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span>
      <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_type identifier id'>type</span><span class='dot token'>.</span><span class='rubyid_respond_to? fid id'>respond_to?</span> <span class='symbol val'>:from_json</span>

        <span class='comment val'># Allow the request to specify how the incoming JSON is encoded, but</span>
        <span class='comment val'># convert to UTF-8 for processing</span>
        <span class='rubyid_if if kw'>if</span> <span class='rubyid_request identifier id'>request</span><span class='dot token'>.</span><span class='rubyid_content_charset identifier id'>content_charset</span>
          <span class='rubyid_value identifier id'>value</span> <span class='assign token'>=</span> <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_force_encoding identifier id'>force_encoding</span><span class='lparen token'>(</span><span class='rubyid_request identifier id'>request</span><span class='dot token'>.</span><span class='rubyid_content_charset identifier id'>content_charset</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_encode identifier id'>encode</span><span class='lparen token'>(</span><span class='string val'>&quot;UTF-8&quot;</span><span class='rparen token'>)</span>
        <span class='rubyid_end end kw'>end</span>

        <span class='rubyid_type identifier id'>type</span><span class='dot token'>.</span><span class='rubyid_from_json identifier id'>from_json</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span>
      <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_type identifier id'>type</span><span class='dot token'>.</span><span class='rubyid_is_a? fid id'>is_a?</span> <span class='rubyid_Array constant id'>Array</span>
        <span class='rubyid_if if kw'>if</span> <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_is_a? fid id'>is_a?</span> <span class='rubyid_Array constant id'>Array</span>
          <span class='rubyid_value identifier id'>value</span><span class='dot token'>.</span><span class='rubyid_map identifier id'>map</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_elt identifier id'>elt</span><span class='bitor op'>|</span> <span class='rubyid_coerce_type identifier id'>coerce_type</span><span class='lparen token'>(</span><span class='rubyid_elt identifier id'>elt</span><span class='comma token'>,</span> <span class='rubyid_type identifier id'>type</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rbrace token'>}</span>
        <span class='rubyid_else else kw'>else</span>
          <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_ArgumentError constant id'>ArgumentError</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>&quot;Not an array&quot;</span><span class='rparen token'>)</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_type identifier id'>type</span><span class='dot token'>.</span><span class='rubyid_is_a? fid id'>is_a?</span> <span class='rubyid_Regexp constant id'>Regexp</span>
        <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_ArgumentError constant id'>ArgumentError</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='dstring node'>&quot;Value &#39;#{value}&#39; didn&#39;t match #{type}&quot;</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_value identifier id'>value</span> <span class='nmatch op'>!~</span> <span class='rubyid_type identifier id'>type</span>
        <span class='rubyid_value identifier id'>value</span>
      <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_type identifier id'>type</span><span class='dot token'>.</span><span class='rubyid_respond_to? fid id'>respond_to?</span> <span class='symbol val'>:value</span>
        <span class='rubyid_type identifier id'>type</span><span class='dot token'>.</span><span class='rubyid_value identifier id'>value</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span>
      <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_type identifier id'>type</span> <span class='eq op'>==</span> <span class='rubyid_String constant id'>String</span>
        <span class='rubyid_value identifier id'>value</span>
      <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_type identifier id'>type</span> <span class='eq op'>==</span> <span class='symbol val'>:body_stream</span>
        <span class='rubyid_value identifier id'>value</span>
      <span class='rubyid_else else kw'>else</span>
        <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_BadParamsException constant id'>BadParamsException</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='dstring node'>&quot;Type not recognized: #{type}&quot;</span><span class='rparen token'>)</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>


    <span class='rubyid_def def kw'>def</span> <span class='rubyid_process_pagination_params identifier id'>process_pagination_params</span><span class='lparen token'>(</span><span class='rubyid_params identifier id'>params</span><span class='comma token'>,</span> <span class='rubyid_known_params identifier id'>known_params</span><span class='comma token'>,</span> <span class='rubyid_errors identifier id'>errors</span><span class='comma token'>,</span> <span class='rubyid_paged identifier id'>paged</span><span class='rparen token'>)</span>
      <span class='rubyid_known_params identifier id'>known_params</span><span class='lbrack token'>[</span><span class='string val'>&#39;resolve&#39;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_known_params identifier id'>known_params</span><span class='lbrack token'>[</span><span class='string val'>&#39;modified_since&#39;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_true true kw'>true</span>

      <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='string val'>&#39;modified_since&#39;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_coerce_type identifier id'>coerce_type</span><span class='lparen token'>(</span><span class='lparen token'>(</span><span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:modified_since</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='string val'>&#39;0&#39;</span><span class='rparen token'>)</span><span class='comma token'>,</span>
                                            <span class='rubyid_NonNegativeInteger constant id'>NonNegativeInteger</span><span class='rparen token'>)</span>

      <span class='rubyid_if if kw'>if</span> <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:page</span><span class='rbrack token'>]</span>
        <span class='rubyid_known_params identifier id'>known_params</span><span class='lbrack token'>[</span><span class='string val'>&#39;page_size&#39;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_known_params identifier id'>known_params</span><span class='lbrack token'>[</span><span class='string val'>&#39;page&#39;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_true true kw'>true</span>
        <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='string val'>&#39;page_size&#39;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_coerce_type identifier id'>coerce_type</span><span class='lparen token'>(</span><span class='lparen token'>(</span><span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:page_size</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='rubyid_AppConfig constant id'>AppConfig</span><span class='lbrack token'>[</span><span class='symbol val'>:default_page_size</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='rubyid_PageSize constant id'>PageSize</span><span class='rparen token'>)</span>
        <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='string val'>&#39;page&#39;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_coerce_type identifier id'>coerce_type</span><span class='lparen token'>(</span><span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:page</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_NonNegativeInteger constant id'>NonNegativeInteger</span><span class='rparen token'>)</span>

      <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:id_set</span><span class='rbrack token'>]</span>
        <span class='rubyid_known_params identifier id'>known_params</span><span class='lbrack token'>[</span><span class='string val'>&#39;id_set&#39;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_true true kw'>true</span>
        <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='string val'>&#39;id_set&#39;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_coerce_type identifier id'>coerce_type</span><span class='lparen token'>(</span><span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:id_set</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_IdSet constant id'>IdSet</span><span class='rparen token'>)</span>

      <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:all_ids</span><span class='rbrack token'>]</span>
        <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='string val'>&#39;all_ids&#39;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_known_params identifier id'>known_params</span><span class='lbrack token'>[</span><span class='string val'>&#39;all_ids&#39;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_true true kw'>true</span>

      <span class='rubyid_else else kw'>else</span>
        <span class='comment val'># paged and paginated routes both support accessing results a page at a time,</span>
        <span class='comment val'>#   via the page and page_size arguments</span>
        <span class='comment val'># paginated routes additionally support:</span>
        <span class='comment val'>#   - fetching all database ids as an array via all_ids</span>
        <span class='comment val'>#   - fetching a set of specific known ids via id_set</span>
        <span class='rubyid_if if kw'>if</span> <span class='rubyid_paged identifier id'>paged</span>
          <span class='comment val'># Must provide page</span>
          <span class='rubyid_errors identifier id'>errors</span><span class='lbrack token'>[</span><span class='symbol val'>:missing</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='lbrace token'>{</span>
            <span class='symbol val'>:name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&#39;page&#39;</span><span class='comma token'>,</span>
            <span class='symbol val'>:doc</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;Must provide &#39;page&#39; (a number)&quot;</span>
          <span class='rbrace token'>}</span>
        <span class='rubyid_else else kw'>else</span>
          <span class='comment val'># Must provide either page, id_set or all_ids</span>
          <span class='lbrack token'>[</span><span class='string val'>&#39;page&#39;</span><span class='comma token'>,</span> <span class='string val'>&#39;id_set&#39;</span><span class='comma token'>,</span> <span class='string val'>&#39;all_ids&#39;</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_name identifier id'>name</span><span class='bitor op'>|</span>
            <span class='rubyid_errors identifier id'>errors</span><span class='lbrack token'>[</span><span class='symbol val'>:missing</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='lbrace token'>{</span>
              <span class='symbol val'>:name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_name identifier id'>name</span><span class='comma token'>,</span>
              <span class='symbol val'>:doc</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;Must provide either &#39;page&#39; (a number), &#39;id_set&#39; (an array of record IDs), or &#39;all_ids&#39; (a boolean)&quot;</span>
            <span class='rbrace token'>}</span>
          <span class='rubyid_end end kw'>end</span>
        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>


    <span class='rubyid_def def kw'>def</span> <span class='rubyid_process_indexed_params identifier id'>process_indexed_params</span><span class='lparen token'>(</span><span class='rubyid_name identifier id'>name</span><span class='comma token'>,</span> <span class='rubyid_params identifier id'>params</span><span class='rparen token'>)</span>
      <span class='rubyid_if if kw'>if</span> <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='rubyid_name identifier id'>name</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='rubyid_name identifier id'>name</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='rubyid_Hash constant id'>Hash</span><span class='rparen token'>)</span>
        <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='rubyid_name identifier id'>name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='rubyid_name identifier id'>name</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_sort_by identifier id'>sort_by</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='symbol val'>:first</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_map identifier id'>map</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='symbol val'>:last</span><span class='rparen token'>)</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>


    <span class='rubyid_def def kw'>def</span> <span class='rubyid_process_declared_params identifier id'>process_declared_params</span><span class='lparen token'>(</span><span class='rubyid_declared_params identifier id'>declared_params</span><span class='comma token'>,</span> <span class='rubyid_params identifier id'>params</span><span class='comma token'>,</span> <span class='rubyid_known_params identifier id'>known_params</span><span class='comma token'>,</span> <span class='rubyid_errors identifier id'>errors</span><span class='rparen token'>)</span>
      <span class='rubyid_declared_params identifier id'>declared_params</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_definition identifier id'>definition</span><span class='bitor op'>|</span>

        <span class='lparen token'>(</span><span class='rubyid_name identifier id'>name</span><span class='comma token'>,</span> <span class='rubyid_type identifier id'>type</span><span class='comma token'>,</span> <span class='rubyid_doc identifier id'>doc</span><span class='comma token'>,</span> <span class='rubyid_opts identifier id'>opts</span><span class='rparen token'>)</span> <span class='assign token'>=</span> <span class='rubyid_definition identifier id'>definition</span>
        <span class='rubyid_opts identifier id'>opts</span> <span class='opasgn op'>||=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>

        <span class='rubyid_if if kw'>if</span> <span class='lparen token'>(</span><span class='rubyid_type identifier id'>type</span><span class='dot token'>.</span><span class='rubyid_is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='rubyid_Array constant id'>Array</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
          <span class='rubyid_process_indexed_params identifier id'>process_indexed_params</span><span class='lparen token'>(</span><span class='rubyid_name identifier id'>name</span><span class='comma token'>,</span> <span class='rubyid_params identifier id'>params</span><span class='rparen token'>)</span>
        <span class='rubyid_end end kw'>end</span>

        <span class='rubyid_known_params identifier id'>known_params</span><span class='lbrack token'>[</span><span class='rubyid_name identifier id'>name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_true true kw'>true</span>

        <span class='rubyid_if if kw'>if</span> <span class='rubyid_opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:body</span><span class='rbrack token'>]</span>
          <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='rubyid_name identifier id'>name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_request identifier id'>request</span><span class='dot token'>.</span><span class='rubyid_body identifier id'>body</span><span class='dot token'>.</span><span class='rubyid_read identifier id'>read</span>
        <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_type identifier id'>type</span> <span class='eq op'>==</span> <span class='symbol val'>:body_stream</span>
          <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='rubyid_name identifier id'>name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_request identifier id'>request</span><span class='dot token'>.</span><span class='rubyid_body identifier id'>body</span>
        <span class='rubyid_end end kw'>end</span>

        <span class='rubyid_if if kw'>if</span> <span class='rubyid_not not kw'>not</span> <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='rubyid_name identifier id'>name</span><span class='rbrack token'>]</span> <span class='rubyid_and and kw'>and</span> <span class='notop op'>!</span><span class='rubyid_opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:optional</span><span class='rbrack token'>]</span> <span class='rubyid_and and kw'>and</span> <span class='notop op'>!</span><span class='rubyid_opts identifier id'>opts</span><span class='dot token'>.</span><span class='rubyid_has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='symbol val'>:default</span><span class='rparen token'>)</span>
          <span class='rubyid_errors identifier id'>errors</span><span class='lbrack token'>[</span><span class='symbol val'>:missing</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='lbrace token'>{</span><span class='symbol val'>:name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_name identifier id'>name</span><span class='comma token'>,</span> <span class='symbol val'>:doc</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_doc identifier id'>doc</span><span class='rbrace token'>}</span>
        <span class='rubyid_else else kw'>else</span>

          <span class='rubyid_if if kw'>if</span> <span class='rubyid_type identifier id'>type</span> <span class='rubyid_and and kw'>and</span> <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='rubyid_name identifier id'>name</span><span class='rbrack token'>]</span>
            <span class='rubyid_begin begin kw'>begin</span>
              <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='rubyid_name identifier id'>name</span><span class='dot token'>.</span><span class='rubyid_intern identifier id'>intern</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_coerce_type identifier id'>coerce_type</span><span class='lparen token'>(</span><span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='rubyid_name identifier id'>name</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='rubyid_type identifier id'>type</span><span class='rparen token'>)</span>
              <span class='rubyid_params identifier id'>params</span><span class='dot token'>.</span><span class='rubyid_delete identifier id'>delete</span><span class='lparen token'>(</span><span class='rubyid_name identifier id'>name</span><span class='rparen token'>)</span>

            <span class='rubyid_rescue rescue kw'>rescue</span> <span class='rubyid_ArgumentError constant id'>ArgumentError</span>
              <span class='rubyid_errors identifier id'>errors</span><span class='lbrack token'>[</span><span class='symbol val'>:bad_type</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='lbrace token'>{</span><span class='symbol val'>:name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_name identifier id'>name</span><span class='comma token'>,</span> <span class='symbol val'>:doc</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_doc identifier id'>doc</span><span class='comma token'>,</span> <span class='symbol val'>:type</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_type identifier id'>type</span><span class='rbrace token'>}</span>
            <span class='rubyid_end end kw'>end</span>
          <span class='rubyid_elsif elsif kw'>elsif</span> <span class='rubyid_type identifier id'>type</span> <span class='rubyid_and and kw'>and</span> <span class='rubyid_opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:default</span><span class='rbrack token'>]</span>
            <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='rubyid_name identifier id'>name</span><span class='dot token'>.</span><span class='rubyid_intern identifier id'>intern</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rubyid_opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:default</span><span class='rbrack token'>]</span>
            <span class='rubyid_params identifier id'>params</span><span class='dot token'>.</span><span class='rubyid_delete identifier id'>delete</span><span class='lparen token'>(</span><span class='rubyid_name identifier id'>name</span><span class='rparen token'>)</span>
          <span class='rubyid_end end kw'>end</span>

          <span class='rubyid_if if kw'>if</span> <span class='rubyid_opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:validation</span><span class='rbrack token'>]</span>
            <span class='rubyid_if if kw'>if</span> <span class='rubyid_not not kw'>not</span> <span class='rubyid_opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:validation</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_call identifier id'>call</span><span class='lparen token'>(</span><span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='rubyid_name identifier id'>name</span><span class='dot token'>.</span><span class='rubyid_intern identifier id'>intern</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
              <span class='rubyid_errors identifier id'>errors</span><span class='lbrack token'>[</span><span class='symbol val'>:failed_validation</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='lbrace token'>{</span><span class='symbol val'>:name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_name identifier id'>name</span><span class='comma token'>,</span> <span class='symbol val'>:doc</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_doc identifier id'>doc</span><span class='comma token'>,</span> <span class='symbol val'>:type</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_type identifier id'>type</span><span class='comma token'>,</span> <span class='symbol val'>:validation</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:validation</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='rbrace token'>}</span>
            <span class='rubyid_end end kw'>end</span>
          <span class='rubyid_end end kw'>end</span>

        <span class='rubyid_end end kw'>end</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>


    <span class='rubyid_def def kw'>def</span> <span class='rubyid_ensure_params identifier id'>ensure_params</span><span class='lparen token'>(</span><span class='rubyid_declared_params identifier id'>declared_params</span><span class='comma token'>,</span> <span class='rubyid_paginated identifier id'>paginated</span><span class='comma token'>,</span> <span class='rubyid_paged identifier id'>paged</span><span class='rparen token'>)</span>

      <span class='rubyid_errors identifier id'>errors</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span>
        <span class='symbol val'>:missing</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
        <span class='symbol val'>:bad_type</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
        <span class='symbol val'>:failed_validation</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
      <span class='rbrace token'>}</span>

      <span class='rubyid_known_params identifier id'>known_params</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>

      <span class='rubyid_process_declared_params identifier id'>process_declared_params</span><span class='lparen token'>(</span><span class='rubyid_declared_params identifier id'>declared_params</span><span class='comma token'>,</span> <span class='rubyid_params identifier id'>params</span><span class='comma token'>,</span> <span class='rubyid_known_params identifier id'>known_params</span><span class='comma token'>,</span> <span class='rubyid_errors identifier id'>errors</span><span class='rparen token'>)</span>
      <span class='rubyid_process_pagination_params identifier id'>process_pagination_params</span><span class='lparen token'>(</span><span class='rubyid_params identifier id'>params</span><span class='comma token'>,</span> <span class='rubyid_known_params identifier id'>known_params</span><span class='comma token'>,</span> <span class='rubyid_errors identifier id'>errors</span><span class='comma token'>,</span> <span class='rubyid_paged identifier id'>paged</span><span class='rparen token'>)</span> <span class='rubyid_if if_mod kw'>if</span> <span class='rubyid_paginated identifier id'>paginated</span> <span class='orop op'>||</span> <span class='rubyid_paged identifier id'>paged</span>

      <span class='comment val'># Any params that were passed in that aren&#39;t declared by our endpoint get dropped here.</span>
      <span class='rubyid_unknown_params identifier id'>unknown_params</span> <span class='assign token'>=</span> <span class='rubyid_params identifier id'>params</span><span class='dot token'>.</span><span class='rubyid_keys identifier id'>keys</span><span class='dot token'>.</span><span class='rubyid_reject identifier id'>reject</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rubyid_p identifier id'>p</span><span class='bitor op'>|</span> <span class='rubyid_known_params identifier id'>known_params</span><span class='lbrack token'>[</span><span class='rubyid_p identifier id'>p</span><span class='dot token'>.</span><span class='rubyid_to_s identifier id'>to_s</span><span class='rbrack token'>]</span> <span class='rbrace token'>}</span>

      <span class='rubyid_unknown_params identifier id'>unknown_params</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_p identifier id'>p</span><span class='bitor op'>|</span>
        <span class='rubyid_params identifier id'>params</span><span class='dot token'>.</span><span class='rubyid_delete identifier id'>delete</span><span class='lparen token'>(</span><span class='rubyid_p identifier id'>p</span><span class='rparen token'>)</span>
      <span class='rubyid_end end kw'>end</span>


      <span class='rubyid_if if kw'>if</span> <span class='rubyid_not not kw'>not</span> <span class='rubyid_errors identifier id'>errors</span><span class='dot token'>.</span><span class='rubyid_values identifier id'>values</span><span class='dot token'>.</span><span class='rubyid_flatten identifier id'>flatten</span><span class='dot token'>.</span><span class='rubyid_empty? fid id'>empty?</span>
        <span class='rubyid_result identifier id'>result</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>

        <span class='rubyid_errors identifier id'>errors</span><span class='lbrack token'>[</span><span class='symbol val'>:missing</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_missing identifier id'>missing</span><span class='bitor op'>|</span>
          <span class='rubyid_result identifier id'>result</span><span class='lbrack token'>[</span><span class='rubyid_missing identifier id'>missing</span><span class='lbrack token'>[</span><span class='symbol val'>:name</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='string val'>&quot;Parameter required but no value provided&quot;</span><span class='rbrack token'>]</span>
        <span class='rubyid_end end kw'>end</span>

        <span class='rubyid_errors identifier id'>errors</span><span class='lbrack token'>[</span><span class='symbol val'>:bad_type</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_bad identifier id'>bad</span><span class='bitor op'>|</span>
          <span class='rubyid_provided_value identifier id'>provided_value</span> <span class='assign token'>=</span> <span class='rubyid_params identifier id'>params</span><span class='lbrack token'>[</span><span class='rubyid_bad identifier id'>bad</span><span class='lbrack token'>[</span><span class='symbol val'>:name</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span>
          <span class='rubyid_msg identifier id'>msg</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;Wanted type #{bad[:type]} but got &#39;#{provided_value}&#39;&quot;</span>


          <span class='rubyid_if if kw'>if</span> <span class='rubyid_bad identifier id'>bad</span><span class='lbrack token'>[</span><span class='symbol val'>:type</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='rubyid_Array constant id'>Array</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span>
             <span class='notop op'>!</span><span class='rubyid_provided_value identifier id'>provided_value</span><span class='dot token'>.</span><span class='rubyid_is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='rubyid_Array constant id'>Array</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span>
             <span class='rubyid_provided_value identifier id'>provided_value</span><span class='dot token'>.</span><span class='rubyid_is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='rubyid_bad identifier id'>bad</span><span class='lbrack token'>[</span><span class='symbol val'>:type</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
            <span class='comment val'># The caller got the right type but didn&#39;t wrap it in an array.</span>
            <span class='comment val'># Provide a more useful error message.</span>
            <span class='rubyid_msg identifier id'>msg</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;.  Perhaps you meant to specify an array like: #{bad[:name]}[]=#{URI.escape(provided_value)}&quot;</span>
          <span class='rubyid_end end kw'>end</span>

          <span class='rubyid_result identifier id'>result</span><span class='lbrack token'>[</span><span class='rubyid_bad identifier id'>bad</span><span class='lbrack token'>[</span><span class='symbol val'>:name</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rubyid_msg identifier id'>msg</span><span class='rbrack token'>]</span>
        <span class='rubyid_end end kw'>end</span>

        <span class='rubyid_errors identifier id'>errors</span><span class='lbrack token'>[</span><span class='symbol val'>:failed_validation</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_each identifier id'>each</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_failed identifier id'>failed</span><span class='bitor op'>|</span>
          <span class='rubyid_result identifier id'>result</span><span class='lbrack token'>[</span><span class='rubyid_failed identifier id'>failed</span><span class='lbrack token'>[</span><span class='symbol val'>:name</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='dstring node'>&quot;Failed validation -- #{failed[:validation]}&quot;</span><span class='rbrack token'>]</span>
        <span class='rubyid_end end kw'>end</span>

        <span class='rubyid_raise identifier id'>raise</span> <span class='rubyid_BadParamsException constant id'>BadParamsException</span><span class='dot token'>.</span><span class='rubyid_new identifier id'>new</span><span class='lparen token'>(</span><span class='rubyid_result identifier id'>result</span><span class='rparen token'>)</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  ArchivesSpace Version v2.8.0.a Documentation Generated on Thu Jul 16 10:06:49 2020 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.20.
</div>

    </div>
  </body>
</html>